<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Produzione Scritta - CILS B2</title>
    <style>
        body {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1000px;
            margin: 10px auto 20px auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 15px 30px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 25px;
            text-align: center;
        }

        .header h1 {
            margin: 0;
            font-size: 2em;
            font-weight: 300;
        }

        .header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
            font-size: 1.1em;
        }

        .content {
            padding: 30px;
        }

        .section {
            margin-bottom: 40px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 12px;
            border-left: 5px solid #3498db;
        }

        .section-title {
            font-size: 1.4em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .prova-box {
            background: #e8f4fd;
            border: 2px solid #3498db;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .prova-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .consegna {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }

        .consegna-text {
            font-weight: 500;
            color: #856404;
            line-height: 1.6;
        }

        .word-count {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
            font-weight: bold;
            color: #0c5460;
            margin: 10px 0;
        }

        .example-section {
            margin-top: 30px;
        }

        .example-box {
            background: white;
            border: 2px solid #27ae60;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .example-title {
            color: #27ae60;
            font-weight: bold;
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .example-text {
            line-height: 1.7;
            color: #2c3e50;
            font-size: 1em;
            text-align: justify;
        }

        .annotation {
            background: #f0f8ff;
            border-left: 3px solid #3498db;
            padding: 10px;
            margin: 15px 0;
            font-size: 0.9em;
            color: #2c3e50;
        }

        .tips-section {
            background: #e8f5e8;
            border: 2px solid #27ae60;
            border-radius: 10px;
            padding: 20px;
            margin: 25px 0;
        }

        .tips-title {
            color: #27ae60;
            font-weight: bold;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .tip-item {
            margin: 10px 0;
            padding-left: 20px;
            position: relative;
        }

        .tip-item::before {
            content: "üí°";
            position: absolute;
            left: 0;
        }

        .back-btn {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(44, 62, 80, 0.9);
            color: white;
            border: 2px solid rgba(255,255,255,0.3);
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 500;
            transition: all 0.3s ease;
            z-index: 1000;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            text-decoration: none;
        }

        .back-btn:hover {
            background: rgba(255,255,255,0.3);
            border-color: rgba(255,255,255,0.5);
            transform: scale(1.05);
        }

        .practice-btn {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 500;
            transition: all 0.3s ease;
            margin: 20px auto;
            display: block;
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.3);
        }

        .practice-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(39, 174, 96, 0.4);
        }

        .criteria-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .criteria-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }

        .criteria-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 8px;
        }

        .criteria-desc {
            font-size: 0.9em;
            color: #7f8c8d;
            line-height: 1.4;
        }

        .exercise-category {
            margin: 30px 0;
        }

        .category-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 25px;
            padding: 15px;
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border-radius: 10px;
            text-align: center;
        }

        .topic-group {
            margin: 25px 0;
        }

        .topic-group-title {
            font-size: 1.1em;
            font-weight: bold;
            color: #27ae60;
            margin-bottom: 15px;
            padding: 10px 15px;
            background: #e8f5e8;
            border-left: 4px solid #27ae60;
            border-radius: 5px;
        }

        .exercise-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }

        .exercise-card {
            background: white;
            border: 2px solid #ecf0f1;
            border-radius: 10px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .exercise-card:hover {
            border-color: #3498db;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.2);
        }

        .exercise-number {
            background: #3498db;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9em;
            margin-bottom: 10px;
        }

        .exercise-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 1.1em;
        }

        .exercise-preview {
            color: #7f8c8d;
            font-size: 0.9em;
            line-height: 1.4;
        }

        .modal {
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 15px 30px rgba(0,0,0,0.3);
        }

        .close {
            position: absolute;
            right: 15px;
            top: 15px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: #aaa;
            transition: color 0.3s ease;
        }

        .close:hover {
            color: #e74c3c;
        }

        .modal-actions {
            text-align: center;
            margin-top: 20px;
        }

        .exercise-content {
            line-height: 1.6;
        }

        .exercise-content h3 {
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .exercise-content .consegna {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            font-weight: 500;
            color: #856404;
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .container {
                margin: 0 auto 80px auto;
                border-radius: 12px;
            }
            
            .header {
                padding: 20px 15px;
            }
            
            .header h1 {
                font-size: 1.5em;
                line-height: 1.2;
            }

            .header p {
                font-size: 1em;
            }
            
            .content {
                padding: 15px 10px;
            }
            
            .section {
                padding: 15px 12px;
                margin-bottom: 20px;
            }

            .section-title {
                font-size: 1.2em;
                line-height: 1.3;
                text-align: center;
            }

            .prova-box {
                padding: 15px;
                margin: 15px 0;
            }

            .prova-title {
                font-size: 1.1em;
            }

            .consegna {
                padding: 12px;
                margin: 12px 0;
            }

            .consegna-text {
                font-size: 0.95em;
                line-height: 1.5;
            }

            .word-count {
                padding: 8px;
                font-size: 0.9em;
            }

            .criteria-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .criteria-item {
                padding: 12px;
            }

            .criteria-title {
                font-size: 0.95em;
            }

            .criteria-desc {
                font-size: 0.85em;
            }

            .exercise-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }

            .exercise-card {
                padding: 15px;
            }

            .exercise-title {
                font-size: 1em;
            }

            .exercise-preview {
                font-size: 0.85em;
            }

            .category-title {
                font-size: 1.1em;
                padding: 12px;
            }

            .topic-group-title {
                font-size: 1em;
                padding: 8px 12px;
            }

            .example-box {
                padding: 15px;
                margin: 15px 0;
            }

            .example-title {
                font-size: 1em;
                line-height: 1.3;
            }

            .example-text {
                font-size: 0.9em;
                line-height: 1.6;
            }

            .annotation {
                padding: 8px;
                margin: 10px 0;
                font-size: 0.85em;
            }

            .tips-section {
                padding: 15px;
                margin: 20px 0;
            }

            .tips-title {
                font-size: 1.1em;
            }

            .tip-item {
                font-size: 0.9em;
                margin: 8px 0;
                padding-left: 25px;
            }

            .practice-btn {
                padding: 12px 25px;
                font-size: 1em;
                margin: 15px auto;
            }

            .modal-content {
                width: 95%;
                padding: 15px;
                max-height: 85vh;
                margin: 20px 10px;
            }

            .modal-content h3 {
                font-size: 1.1em;
                line-height: 1.3;
            }

            .exercise-content .consegna {
                font-size: 0.9em;
                padding: 10px;
            }

            .back-btn {
                bottom: 15px;
                left: 15px;
                padding: 10px 15px;
                font-size: 0.85em;
                border-radius: 20px;
            }

            /* Am√©lioration des formules utiles sur mobile */
            .tips-section > div[style*="grid-template-columns"] {
                display: block !important;
            }

            .tips-section > div[style*="grid-template-columns"] > div {
                margin-bottom: 15px !important;
            }

            /* Texte des exemples plus lisible sur mobile */
            .example-text[style*="monospace"] {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif !important;
                font-size: 0.85em !important;
                padding: 10px !important;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 5px;
            }

            .header h1 {
                font-size: 1.3em;
            }

            .content {
                padding: 10px 8px;
            }

            .section {
                padding: 12px 10px;
            }

            .section-title {
                font-size: 1.1em;
            }

            .prova-box {
                padding: 12px;
            }

            .example-text {
                font-size: 0.85em;
            }

            .modal-content {
                width: 98%;
                padding: 12px;
                margin: 10px 5px;
            }

            .close {
                font-size: 24px;
                right: 10px;
                top: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚úçÔ∏è Produzione Scritta</h1>
            <p>CILS B2 - Modelli e Correzioni</p>
        </div>

        <div class="content">
            <!-- Back Button -->
            <a href="cils.html" class="back-btn">‚Üê Indietro</a>

            <!-- Prova 1 Section -->
            <div class="section">
                <div class="section-title">
                    üìù PROVA 1 - Testo narrativo personale
                </div>

                <div class="prova-box">
                    <div class="prova-title">Consegna dell'esame:</div>
                    <div class="consegna">
                        <div class="consegna-text">
                            <strong>Racconta come hai affrontato un impegno importante o un imprevisto della tua vita.</strong><br>
                            Spiega se sei stato soddisfatto del tuo modo di agire e perch√©.
                        </div>
                    </div>
                    <div class="word-count">
                        üìä Lunghezza richiesta: 120-140 parole
                    </div>
                </div>

                <!-- Criteri di valutazione -->
                <div class="tips-section">
                    <div class="tips-title">üéØ Criteri di Valutazione</div>
                    <div class="criteria-grid">
                        <div class="criteria-item">
                            <div class="criteria-title">Contenuto</div>
                            <div class="criteria-desc">Aderenza alla traccia, completezza delle informazioni richieste</div>
                        </div>
                        <div class="criteria-item">
                            <div class="criteria-title">Organizzazione</div>
                            <div class="criteria-desc">Struttura logica, coerenza, uso di connettivi</div>
                        </div>
                        <div class="criteria-item">
                            <div class="criteria-title">Lessico</div>
                            <div class="criteria-desc">Variet√†, appropriatezza, precisione del vocabolario</div>
                        </div>
                        <div class="criteria-item">
                            <div class="criteria-title">Grammatica</div>
                            <div class="criteria-desc">Correttezza morfosinttatica, variet√† delle strutture</div>
                        </div>
                    </div>
                </div>

                <!-- Esempio 1 -->
                <div class="example-section">
                    <div class="example-box">
                        <div class="example-title">‚úÖ ESEMPIO 1 - Testo eccellente </div>
                        <div class="example-text">
                            L'anno scorso ho dovuto affrontare un imprevisto che ha cambiato completamente i miei piani: mia nonna si √® ammalata gravemente proprio durante la settimana degli esami universitari. Inizialmente mi sono sentita sopraffatta perch√© dovevo scegliere tra i miei studi e la famiglia.
                            <br><br>
                            Ho deciso di rimandare due esami per poter assistere mia nonna in ospedale. Anche se questo significava perdere una sessione, ho organizzato il mio tempo per studiare la sera dopo le visite. √à stato difficile concentrarmi, ma ho chiesto aiuto ai miei compagni di corso per gli appunti.
                            <br><br>
                            Sono molto soddisfatta della mia scelta perch√© ho potuto stare vicino a una persona cara nel momento del bisogno. Inoltre, ho imparato a gestire meglio le priorit√† e lo stress. Mia nonna √® guarita e io ho superato tutti gli esami con ottimi voti.
                        </div>
                        <div class="annotation">
                            <strong>Punti di forza:</strong> Struttura chiara (situazione ‚Üí azione ‚Üí riflessione), lessico appropriato, variet√† di tempi verbali, rispetto del limite di parole (138 parole), contenuto completo e personale.
                        </div>
                    </div>

                    <!-- Esempio 2 -->
                    <div class="example-box">
                        <div class="example-title">‚úÖ ESEMPIO 2 - Testo buono </div>
                        <div class="example-text">
                            Due anni fa ho avuto un grande impegno: dovevo organizzare il matrimonio di mia sorella perch√© lei viveva all'estero. Non avevo mai fatto una cosa cos√¨ importante e all'inizio ero molto preoccupata.
                            <br><br>
                            Ho fatto una lista di tutte le cose da fare: prenotare la chiesa, scegliere il ristorante, comprare i fiori e mandare gli inviti. Ho chiamato molti posti e ho confrontato i prezzi. Mia madre mi ha aiutato con i vestiti e le decorazioni.
                            <br><br>
                            Il matrimonio √® stato bellissimo e tutti erano contenti. Sono soddisfatta perch√© ho imparato a organizzare eventi importanti e ho fatto felice mia sorella. Adesso so che posso affrontare situazioni difficili se mi organizzo bene.
                        </div>
                        <div class="annotation">
                            <strong>Punti di forza:</strong> Contenuto appropriato, struttura semplice ma efficace (125 parole). <strong>Da migliorare:</strong> Lessico pi√π vario, connettivi pi√π sofisticati, maggiore profondit√† nella riflessione personale.
                        </div>
                    </div>

                    <!-- Esempio con errori -->
                    <div class="example-box" style="border-color: #e74c3c;">
                        <div class="example-title" style="color: #e74c3c;">‚ùå ESEMPIO DA EVITARE - Testo Insufficiente (Voto: 10-12/20)</div>
                        <div class="example-text">
                            Una volta ho avuto un problema con la macchina. Era rotta e dovevo andare al lavoro. Ho chiamato il meccanico ma non poteva venire subito.
                            <br><br>
                            Allora ho preso l'autobus. Era molto lento e sono arrivato tardi. Il mio capo era arrabbiato ma ho spiegato il problema.
                            <br><br>
                            Penso che ho fatto bene perch√© non potevo fare altro. La prossima volta controller√≤ la macchina prima.
                        </div>
                        <div class="annotation" style="background: #fadbd8; border-color: #e74c3c;">
                            <strong>Problemi:</strong> Troppo breve (solo 65 parole), contenuto superficiale, lessico povero, strutture sintattiche semplici, mancanza di riflessione approfondita, non sviluppa adeguatamente la traccia.
                        </div>
                    </div>
                </div>

                <!-- Consigli pratici -->
                <div class="tips-section">
                    <div class="tips-title">üí° Consigli per la prova 1</div>
                    <div class="tip-item">Scegli un episodio significativo della tua vita, non banale</div>
                    <div class="tip-item">Struttura il testo: situazione ‚Üí azioni intraprese ‚Üí riflessione</div>
                    <div class="tip-item">Usa connettivi temporali: inizialmente, poi, alla fine, dopo che...</div>
                    <div class="tip-item">Varia i tempi verbali: passato prossimo, imperfetto, presente</div>
                    <div class="tip-item">Dedica almeno 1/3 del testo alla riflessione personale</div>
                    <div class="tip-item">Controlla sempre il numero di parole (120-140)</div>
                    <div class="tip-item">Rileggi per correggere errori grammaticali e di ortografia</div>
                </div>

                <button class="practice-btn" onclick="startPractice()">
                    üöÄ Inizia esercitazione guidata
                </button>
            </div>

            <!-- Prova 2 Section -->
            <div class="section">
                <div class="section-title">
                    üìß PROVA 2 - Lettera/Email formale
                </div>

                <div class="prova-box">
                    <div class="prova-title">Consegna dell'esame:</div>
                    <div class="consegna">
                        <div class="consegna-text">
                            <strong>A causa di un imprevisto non sei potuto/a essere presente ad un appuntamento che ti aveva dato una professoressa per parlare della tesina sulla sua materia.</strong><br>
                            Scrivi una lettera o una mail in cui ti scusi, spieghi che cosa ti √® successo e chiedi un nuovo incontro.
                        </div>
                    </div>
                    <div class="word-count">
                        üìä Lunghezza richiesta: 80-100 parole
                    </div>
                </div>

                <!-- Struttura lettera formale -->
                <div class="tips-section">
                    <div class="tips-title">üìã Struttura della lettera formale</div>
                    <div class="criteria-grid">
                        <div class="criteria-item">
                            <div class="criteria-title">Intestazione</div>
                            <div class="criteria-desc">Oggetto (per email) o data e luogo (per lettera)</div>
                        </div>
                        <div class="criteria-item">
                            <div class="criteria-title">Saluto</div>
                            <div class="criteria-desc">Gentile Professoressa + cognome</div>
                        </div>
                        <div class="criteria-item">
                            <div class="criteria-title">Corpo</div>
                            <div class="criteria-desc">Scuse + spiegazione + richiesta nuovo appuntamento</div>
                        </div>
                        <div class="criteria-item">
                            <div class="criteria-title">Chiusura</div>
                            <div class="criteria-desc">Formula di cortesia + firma</div>
                        </div>
                    </div>
                </div>

                <!-- Esempio 1 Email -->
                <div class="example-section">
                    <div class="example-box">
                        <div class="example-title">‚úÖ ESEMPIO 1 - Email eccellente </div>
                        <div class="example-text" style="font-family: monospace; background: #f8f9fa; padding: 15px; border-radius: 5px;">
                            <strong>Oggetto:</strong> Richiesta nuovo appuntamento per tesina<br><br>
                            
                            Gentile Professoressa Rossi,<br><br>
                            
                            Le scrivo per scusarmi profondamente per la mia assenza all'appuntamento di ieri alle 15:00. Purtroppo mio padre ha avuto un malore improvviso e ho dovuto accompagnarlo urgentemente in ospedale.<br><br>
                            
                            Sarebbe possibile fissare un nuovo incontro per discutere della mia tesina di letteratura? Sono disponibile nei prossimi giorni secondo le Sue preferenze.<br><br>
                            
                            La ringrazio per la comprensione.<br><br>
                            
                            Cordiali saluti,<br>
                            Marco Bianchi
                        </div>
                        <div class="annotation">
                            <strong>Punti di forza:</strong> Registro formale appropriato, struttura completa, spiegazione chiara e credibile, richiesta cortese, 78 parole (perfetto), tono rispettoso.
                        </div>
                    </div>

                    <!-- Esempio 2 Lettera -->
                    <div class="example-box">
                        <div class="example-title">‚úÖ ESEMPIO 2 - Lettera buona </div>
                        <div class="example-text" style="font-family: monospace; background: #f8f9fa; padding: 15px; border-radius: 5px;">
                            Roma, 15 marzo 2024<br><br>
                            
                            Egregia Professoressa Verdi,<br><br>
                            
                            Mi scuso per non essere venuta all'appuntamento di marted√¨. Ho avuto un problema familiare urgente e non sono riuscita ad avvisarLa in tempo.<br><br>
                            
                            Potremmo fissare un altro incontro per parlare della tesina? Sono libera la prossima settimana.<br><br>
                            
                            Distinti saluti,<br>
                            Anna Neri
                        </div>
                        <div class="annotation">
                            <strong>Punti di forza:</strong> Formato lettera corretto, contenuto appropriato (52 parole). <strong>Da migliorare:</strong> Spiegazione pi√π specifica, maggiore cortesia nelle formule, dettagli sulla disponibilit√†.
                        </div>
                    </div>

                    <!-- Esempio con errori -->
                    <div class="example-box" style="border-color: #e74c3c;">
                        <div class="example-title" style="color: #e74c3c;">‚ùå ESEMPIO DA EVITARE - Testo Insufficiente (Voto: 10-12/20)</div>
                        <div class="example-text" style="font-family: monospace; background: #fadbd8; padding: 15px; border-radius: 5px;">
                            Ciao prof,<br><br>
                            
                            Scusa ma non sono potuto venire ieri. Ho avuto un problema. Possiamo vederci un altro giorno?<br><br>
                            
                            Ciao,<br>
                            Luca
                        </div>
                        <div class="annotation" style="background: #fadbd8; border-color: #e74c3c;">
                            <strong>Problemi:</strong> Registro informale inappropriato, troppo breve (solo 20 parole), mancanza di cortesia, spiegazione vaga, struttura inadeguata per una lettera formale.
                        </div>
                    </div>
                </div>

                <!-- Formule utili -->
                <div class="tips-section">
                    <div class="tips-title">üìù Formule utili per la prova 2</div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin: 20px 0;">
                        <div style="background: white; padding: 15px; border-radius: 8px;">
                            <div style="font-weight: bold; color: #2c3e50; margin-bottom: 10px;">üôè Per scusarsi:</div>
                            <div style="font-size: 0.9em; line-height: 1.5;">
                                ‚Ä¢ Mi scuso profondamente per...<br>
                                ‚Ä¢ Le porgo le mie scuse per...<br>
                                ‚Ä¢ Sono spiacente di non aver potuto...<br>
                                ‚Ä¢ Mi dispiace comunicarLe che...
                            </div>
                        </div>
                        
                        <div style="background: white; padding: 15px; border-radius: 8px;">
                            <div style="font-weight: bold; color: #2c3e50; margin-bottom: 10px;">üìÖ Per chiedere appuntamento:</div>
                            <div style="font-size: 0.9em; line-height: 1.5;">
                                ‚Ä¢ Sarebbe possibile fissare...<br>
                                ‚Ä¢ Potremmo concordare un nuovo...<br>
                                ‚Ä¢ Sono disponibile nei giorni...<br>
                                ‚Ä¢ Le andrebbe bene...?
                            </div>
                        </div>
                        
                        <div style="background: white; padding: 15px; border-radius: 8px;">
                            <div style="font-weight: bold; color: #2c3e50; margin-bottom: 10px;">üéØ Spiegazioni appropriate:</div>
                            <div style="font-size: 0.9em; line-height: 1.5;">
                                ‚Ä¢ Un'emergenza familiare<br>
                                ‚Ä¢ Un problema di salute improvviso<br>
                                ‚Ä¢ Un imprevisto lavorativo<br>
                                ‚Ä¢ Difficolt√† nei trasporti
                            </div>
                        </div>
                        
                        <div style="background: white; padding: 15px; border-radius: 8px;">
                            <div style="font-weight: bold; color: #2c3e50; margin-bottom: 10px;">‚úâÔ∏è Chiusure formali:</div>
                            <div style="font-size: 0.9em; line-height: 1.5;">
                                ‚Ä¢ Cordiali saluti<br>
                                ‚Ä¢ Distinti saluti<br>
                                ‚Ä¢ La ringrazio per la comprensione<br>
                                ‚Ä¢ In attesa di una Sua risposta
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Consigli specifici Prova 2 -->
                <div class="tips-section">
                    <div class="tips-title">üí° Consigli per la prova 2</div>
                    <div class="tip-item">Usa sempre il registro formale (Lei, non tu)</div>
                    <div class="tip-item">Includi oggetto nell'email o data nella lettera</div>
                    <div class="tip-item">Sii specifico ma conciso nella spiegazione</div>
                    <div class="tip-item">Proponi alternative concrete per il nuovo appuntamento</div>
                    <div class="tip-item">Mantieni un tono rispettoso e professionale</div>
                    <div class="tip-item">Controlla che sia tra 50-80 parole</div>
                    <div class="tip-item">Rileggi per verificare la correttezza formale</div>
                </div>

                <button class="practice-btn" onclick="startPractice2()">
                    üìß Esercitati con la prova 2
                </button>
            </div>

            <!-- Sezione strategie generali -->
            <div class="section">
                <div class="section-title">
                    üß† STRATEGIE GENERALI per Superare le prove
                </div>

                <!-- Strategie Prova 1 -->
                <div class="tips-section" style="margin-bottom: 30px;">
                    <div class="tips-title">üìù STRATEGIE per la PROVA 1 - Testo narrativo</div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin: 20px 0;">
                        <div style="background: white; padding: 20px; border-radius: 10px; border-left: 5px solid #e74c3c;">
                            <div style="font-weight: bold; color: #e74c3c; margin-bottom: 15px; font-size: 1.1em;">‚è∞ GESTIONE DEL TEMPO (25 minuti)</div>
                            <div style="font-size: 0.9em; line-height: 1.6;">
                                <strong>‚Ä¢ 3 minuti:</strong> Leggi la traccia e pianifica<br>
                                <strong>‚Ä¢ 18 minuti:</strong> Scrivi il testo<br>
                                <strong>‚Ä¢ 4 minuti:</strong> Rileggi e correggi<br><br>
                                <em>üí° Non perdere tempo a pensare troppo: inizia a scrivere!</em>
                            </div>
                        </div>
                        
                        <div style="background: white; padding: 20px; border-radius: 10px; border-left: 5px solid #f39c12;">
                            <div style="font-weight: bold; color: #f39c12; margin-bottom: 15px; font-size: 1.1em;">üéØ SCELTA DELL'EPISODIO</div>
                            <div style="font-size: 0.9em; line-height: 1.6;">
                                <strong>‚úÖ Scegli episodi:</strong><br>
                                ‚Ä¢ Significativi ma non troppo personali<br>
                                ‚Ä¢ Con azioni concrete che hai fatto<br>
                                ‚Ä¢ Che ti permettono di riflettere<br><br>
                                <strong>‚ùå Evita:</strong><br>
                                ‚Ä¢ Episodi banali o troppo semplici<br>
                                ‚Ä¢ Situazioni troppo intime<br>
                                ‚Ä¢ Eventi senza la tua partecipazione attiva
                            </div>
                        </div>
                        
                        <div style="background: white; padding: 20px; border-radius: 10px; border-left: 5px solid #27ae60;">
                            <div style="font-weight: bold; color: #27ae60; margin-bottom: 15px; font-size: 1.1em;">üìê STRUTTURA VINCENTE</div>
                            <div style="font-size: 0.9em; line-height: 1.6;">
                                <strong>Paragrafo 1 (40-50 parole):</strong><br>
                                Quando, dove, perch√©, prime emozioni<br><br>
                                <strong>Paragrafo 2 (50-60 parole):</strong><br>
                                Cosa hai fatto, come hai agito<br><br>
                                <strong>Paragrafo 3 (30-40 parole):</strong><br>
                                Riflessione: soddisfazione, lezioni apprese
                            </div>
                        </div>
                        
                        <div style="background: white; padding: 20px; border-radius: 10px; border-left: 5px solid #3498db;">
                            <div style="font-weight: bold; color: #3498db; margin-bottom: 15px; font-size: 1.1em;">üîó CONNETTIVI ESSENZIALI</div>
                            <div style="font-size: 0.9em; line-height: 1.6;">
                                <strong>Temporali:</strong> Inizialmente, poi, dopo, alla fine, nel frattempo<br><br>
                                <strong>Causali:</strong> Perch√©, dato che, siccome, a causa di<br><br>
                                <strong>Conclusivi:</strong> Quindi, perci√≤, di conseguenza, in conclusione<br><br>
                                <strong>Avversativi:</strong> Per√≤, tuttavia, nonostante, anche se
                            </div>
                        </div>
                        
                        <div style="background: white; padding: 20px; border-radius: 10px; border-left: 5px solid #9b59b6;">
                            <div style="font-weight: bold; color: #9b59b6; margin-bottom: 15px; font-size: 1.1em;">üìä VARIET√Ä LINGUISTICA</div>
                            <div style="font-size: 0.9em; line-height: 1.6;">
                                <strong>Tempi verbali:</strong><br>
                                ‚Ä¢ Passato prossimo (azioni)<br>
                                ‚Ä¢ Imperfetto (descrizioni, stati)<br>
                                ‚Ä¢ Presente (riflessioni attuali)<br><br>
                                <strong>Lessico:</strong><br>
                                ‚Ä¢ Sinonimi per evitare ripetizioni<br>
                                ‚Ä¢ Aggettivi specifici per emozioni<br>
                                ‚Ä¢ Verbi d'azione precisi
                            </div>
                        </div>
                        
                        <div style="background: white; padding: 20px; border-radius: 10px; border-left: 5px solid #e67e22;">
                            <div style="font-weight: bold; color: #e67e22; margin-bottom: 15px; font-size: 1.1em;">‚úÖ CHECKLIST FINALE</div>
                            <div style="font-size: 0.9em; line-height: 1.6;">
                                ‚ñ° Rispetto della traccia<br>
                                ‚ñ° 120-140 parole<br>
                                ‚ñ° Struttura in 3 paragrafi<br>
                                ‚ñ° Riflessione personale presente<br>
                                ‚ñ° Connettivi utilizzati<br>
                                ‚ñ° Variet√† di tempi verbali<br>
                                ‚ñ° Ortografia e punteggiatura corrette
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Strategie Prova 2 -->
                <div class="tips-section">
                    <div class="tips-title">üìß STRATEGIE per la PROVA 2 - Lettera/Email Formale</div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin: 20px 0;">
                        <div style="background: white; padding: 20px; border-radius: 10px; border-left: 5px solid #e74c3c;">
                            <div style="font-weight: bold; color: #e74c3c; margin-bottom: 15px; font-size: 1.1em;">‚è∞ GESTIONE DEL TEMPO (15 minuti)</div>
                            <div style="font-size: 0.9em; line-height: 1.6;">
                                <strong>‚Ä¢ 2 minuti:</strong> Analizza la situazione<br>
                                <strong>‚Ä¢ 10 minuti:</strong> Scrivi la lettera/email<br>
                                <strong>‚Ä¢ 3 minuti:</strong> Rileggi e correggi<br><br>
                                <em>üí° √à pi√π breve ma richiede precisione formale!</em>
                            </div>
                        </div>
                        
                        <div style="background: white; padding: 20px; border-radius: 10px; border-left: 5px solid #f39c12;">
                            <div style="font-weight: bold; color: #f39c12; margin-bottom: 15px; font-size: 1.1em;">üìã ANALISI DELLA SITUAZIONE</div>
                            <div style="font-size: 0.9em; line-height: 1.6;">
                                <strong>Domande chiave:</strong><br>
                                ‚Ä¢ Chi √® il destinatario?<br>
                                ‚Ä¢ Qual √® il rapporto (formale/informale)?<br>
                                ‚Ä¢ Cosa devo chiedere/comunicare?<br>
                                ‚Ä¢ Che tono devo usare?<br>
                                ‚Ä¢ Serve spiegare il motivo?<br>
                                ‚Ä¢ Devo proporre soluzioni?
                            </div>
                        </div>
                        
                        <div style="background: white; padding: 20px; border-radius: 10px; border-left: 5px solid #27ae60;">
                            <div style="font-weight: bold; color: #27ae60; margin-bottom: 15px; font-size: 1.1em;">üèóÔ∏è STRUTTURA FISSA</div>
                            <div style="font-size: 0.9em; line-height: 1.6;">
                                <strong>1. Intestazione:</strong><br>
                                Email: Oggetto chiaro<br>
                                Lettera: Luogo e data<br><br>
                                <strong>2. Saluto formale:</strong><br>
                                Gentile/Egregio + titolo + cognome<br><br>
                                <strong>3. Corpo (3 parti):</strong><br>
                                ‚Ä¢ Presentazione/scuse<br>
                                ‚Ä¢ Spiegazione<br>
                                ‚Ä¢ Richiesta/proposta<br><br>
                                <strong>4. Chiusura + firma</strong>
                            </div>
                        </div>
                        
                        <div style="background: white; padding: 20px; border-radius: 10px; border-left: 5px solid #3498db;">
                            <div style="font-weight: bold; color: #3498db; margin-bottom: 15px; font-size: 1.1em;">üé≠ REGISTRO FORMALE</div>
                            <div style="font-size: 0.9em; line-height: 1.6;">
                                <strong>‚úÖ Usa sempre:</strong><br>
                                ‚Ä¢ Lei (non tu)<br>
                                ‚Ä¢ Condizionale di cortesia<br>
                                ‚Ä¢ Formule di rispetto<br>
                                ‚Ä¢ Lessico appropriato<br><br>
                                <strong>‚ùå Evita:</strong><br>
                                ‚Ä¢ Contrazioni (non c'√® ‚Üí non vi √®)<br>
                                ‚Ä¢ Espressioni colloquiali<br>
                                ‚Ä¢ Tono troppo diretto<br>
                                ‚Ä¢ Emoticon o abbreviazioni
                            </div>
                        </div>
                        
                        <div style="background: white; padding: 20px; border-radius: 10px; border-left: 5px solid #9b59b6;">
                            <div style="font-weight: bold; color: #9b59b6; margin-bottom: 15px; font-size: 1.1em;">üí¨ FORMULE STANDARD</div>
                            <div style="font-size: 0.9em; line-height: 1.6;">
                                <strong>Apertura:</strong><br>
                                ‚Ä¢ Le scrivo per...<br>
                                ‚Ä¢ Mi rivolgo a Lei per...<br>
                                ‚Ä¢ Sono costretto/a a...<br><br>
                                <strong>Scuse:</strong><br>
                                ‚Ä¢ Mi scuso per...<br>
                                ‚Ä¢ Le porgo le mie scuse...<br>
                                ‚Ä¢ Sono spiacente di...<br><br>
                                <strong>Richieste:</strong><br>
                                ‚Ä¢ Sarebbe possibile...?<br>
                                ‚Ä¢ Potrebbe gentilmente...?<br>
                                ‚Ä¢ La prego di...
                            </div>
                        </div>
                        
                        <div style="background: white; padding: 20px; border-radius: 10px; border-left: 5px solid #e67e22;">
                            <div style="font-weight: bold; color: #e67e22; margin-bottom: 15px; font-size: 1.1em;">üéØ ERRORI COMUNI DA EVITARE</div>
                            <div style="font-size: 0.9em; line-height: 1.6;">
                                <strong>‚ùå Contenuto:</strong><br>
                                ‚Ä¢ Dimenticare parti della consegna<br>
                                ‚Ä¢ Essere troppo vaghi<br>
                                ‚Ä¢ Non proporre soluzioni<br><br>
                                <strong>‚ùå Forma:</strong><br>
                                ‚Ä¢ Mescolare tu/Lei<br>
                                ‚Ä¢ Oggetto poco chiaro<br>
                                ‚Ä¢ Chiusura informale<br>
                                ‚Ä¢ Superare 120 parole<br>
                                ‚Ä¢ Essere sotto le 80 parole
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Consigli Trasversali -->
                <div class="tips-section" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                    <div class="tips-title" style="color: white;">üåü CONSIGLI TRASVERSALI per ENTRAMBE le PROVE</div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin: 20px 0;">
                        <div style="background: rgba(255,255,255,0.15); padding: 20px; border-radius: 10px; backdrop-filter: blur(10px);">
                            <div style="font-weight: bold; margin-bottom: 15px; font-size: 1.1em;">üßò PREPARAZIONE MENTALE</div>
                            <div style="font-size: 0.9em; line-height: 1.6;">
                                ‚Ä¢ Arriva riposato/a e concentrato/a<br>
                                ‚Ä¢ Leggi TUTTE le tracce prima di scegliere<br>
                                ‚Ä¢ Non cambiare idea a met√†<br>
                                ‚Ä¢ Mantieni la calma se hai un blocco<br>
                                ‚Ä¢ Fidati della tua preparazione
                            </div>
                        </div>
                        
                        <div style="background: rgba(255,255,255,0.15); padding: 20px; border-radius: 10px; backdrop-filter: blur(10px);">
                            <div style="font-weight: bold; margin-bottom: 15px; font-size: 1.1em;">üìù TECNICA DI SCRITTURA</div>
                            <div style="font-size: 0.9em; line-height: 1.6;">
                                ‚Ä¢ Scrivi in modo leggibile<br>
                                ‚Ä¢ Usa la penna, non la matita<br>
                                ‚Ä¢ Lascia margini adeguati<br>
                                ‚Ä¢ Non cancellare troppo<br>
                                ‚Ä¢ Numera le pagine se necessario
                            </div>
                        </div>
                        
                        <div style="background: rgba(255,255,255,0.15); padding: 20px; border-radius: 10px; backdrop-filter: blur(10px);">
                            <div style="font-weight: bold; margin-bottom: 15px; font-size: 1.1em;">üîç REVISIONE EFFICACE</div>
                            <div style="font-size: 0.9em; line-height: 1.6;">
                                ‚Ä¢ Controlla accordi (articoli, aggettivi)<br>
                                ‚Ä¢ Verifica i verbi (tempi, persone)<br>
                                ‚Ä¢ Rileggi per il senso generale<br>
                                ‚Ä¢ Conta le parole rapidamente<br>
                                ‚Ä¢ Correggi solo errori evidenti
                            </div>
                        </div>
                        
                        <div style="background: rgba(255,255,255,0.15); padding: 20px; border-radius: 10px; backdrop-filter: blur(10px);">
                            <div style="font-weight: bold; margin-bottom: 15px; font-size: 1.1em;">üìö ALLENAMENTO COSTANTE</div>
                            <div style="font-size: 0.9em; line-height: 1.6;">
                                ‚Ä¢ Scrivi almeno 3 testi a settimana<br>
                                ‚Ä¢ Cronometra sempre i tuoi esercizi<br>
                                ‚Ä¢ Fai correggere i tuoi testi<br>
                                ‚Ä¢ Studia i modelli di eccellenza<br>
                                ‚Ä¢ Memorizza formule e connettivi
                            </div>
                        </div>
                    </div>
                    
                    <div style="background: rgba(255,255,255,0.2); padding: 20px; border-radius: 10px; margin-top: 20px; text-align: center;">
                        <div style="font-weight: bold; font-size: 1.2em; margin-bottom: 10px;">üèÜ RICORDA</div>
                        <div style="font-size: 1em; line-height: 1.6;">
                            <em>"La produzione scritta si supera con la PRATICA COSTANTE e la STRATEGIA GIUSTA.<br>
                            Non serve essere scrittori perfetti, serve essere EFFICACI e CORRETTI!"</em>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sezione Esercitazioni -->
            <div class="section">
                <div class="section-title">
                    üéØ ESERCITAZIONI - Tracce per Allenarsi
                </div>

                <!-- Prova 1 Esercitazioni -->
                <div class="exercise-category">
                    <div class="category-title">üìù PROVA 1 - Testi narrativi (120-140 parole)</div>
                    
                    <div class="topic-group">
                        <div class="topic-group-title">üéØ Impegni importanti</div>
                        <div class="exercise-grid">
                            <div class="exercise-card" onclick="showExercise('trasloco')">
                                <div class="exercise-number">1</div>
                                <div class="exercise-title">Trasloco</div>
                                <div class="exercise-preview">Organizzazione di un trasloco in una nuova citt√†...</div>
                            </div>
                            <div class="exercise-card" onclick="showExercise('primo-lavoro')">
                                <div class="exercise-number">2</div>
                                <div class="exercise-title">Primo Lavoro</div>
                                <div class="exercise-preview">Il tuo primo giorno in un nuovo lavoro...</div>
                            </div>
                            <div class="exercise-card" onclick="showExercise('evento')">
                                <div class="exercise-number">3</div>
                                <div class="exercise-title">Organizzazione Evento</div>
                                <div class="exercise-preview">Festa di compleanno per un familiare...</div>
                            </div>
                            <div class="exercise-card" onclick="showExercise('decisione')">
                                <div class="exercise-number">4</div>
                                <div class="exercise-title">Decisione Importante</div>
                                <div class="exercise-preview">Scegliere tra due opportunit√† importanti...</div>
                            </div>
                        </div>
                    </div>

                    <div class="topic-group">
                        <div class="topic-group-title">‚ö° Imprevisti e Emergenze</div>
                        <div class="exercise-grid">
                            <div class="exercise-card" onclick="showExercise('emergenza')">
                                <div class="exercise-number">5</div>
                                <div class="exercise-title">Emergenza Medica</div>
                                <div class="exercise-preview">Un familiare si √® sentito male improvvisamente...</div>
                            </div>
                            <div class="exercise-card" onclick="showExercise('tecnologia')">
                                <div class="exercise-number">6</div>
                                <div class="exercise-title">Problema tecnologico</div>
                                <div class="exercise-preview">Computer rotto prima di una presentazione...</div>
                            </div>
                            <div class="exercise-card" onclick="showExercise('sciopero')">
                                <div class="exercise-number">7</div>
                                <div class="exercise-title">Sciopero trasporti</div>
                                <div class="exercise-preview">Appuntamento importante durante uno sciopero...</div>
                            </div>
                            <div class="exercise-card" onclick="showExercise('maltempo')">
                                <div class="exercise-number">8</div>
                                <div class="exercise-title">Maltempo</div>
                                <div class="exercise-preview">Temporale che rovina piani all'aperto...</div>
                            </div>
                        </div>
                    </div>

                    <div class="topic-group">
                        <div class="topic-group-title">üèÜ Sfide Personali</div>
                        <div class="exercise-grid">
                            <div class="exercise-card" onclick="showExercise('paura')">
                                <div class="exercise-number">9</div>
                                <div class="exercise-title">Paura Superata</div>
                                <div class="exercise-preview">Affrontare una grande paura personale...</div>
                            </div>
                            <div class="exercise-card" onclick="showExercise('obiettivo')">
                                <div class="exercise-number">10</div>
                                <div class="exercise-title">Obiettivo Raggiunto</div>
                                <div class="exercise-preview">Traguardo che sembrava impossibile...</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Prova 2 Esercitazioni -->
                <div class="exercise-category">
                    <div class="category-title">üìß PROVA 2 - Lettere/Email formali (80-120 parole)</div>
                    
                    <div class="topic-group">
                        <div class="topic-group-title">üéì Ambito universitario</div>
                        <div class="exercise-grid">
                            <div class="exercise-card" onclick="showExercise('tesi')">
                                <div class="exercise-number">11</div>
                                <div class="exercise-title">Ritardo Tesi</div>
                                <div class="exercise-preview">Chiedere proroga per consegna tesi...</div>
                            </div>
                            <div class="exercise-card" onclick="showExercise('certificato')">
                                <div class="exercise-number">12</div>
                                <div class="exercise-title">Certificato</div>
                                <div class="exercise-preview">Richiedere certificato di iscrizione...</div>
                            </div>
                            <div class="exercise-card" onclick="showExercise('cambio-corso')">
                                <div class="exercise-number">13</div>
                                <div class="exercise-title">Cambio Corso</div>
                                <div class="exercise-preview">Trasferimento a altro corso di laurea...</div>
                            </div>
                        </div>
                    </div>

                    <div class="topic-group">
                        <div class="topic-group-title">üíº Ambito lavorativo</div>
                        <div class="exercise-grid">
                            <div class="exercise-card" onclick="showExercise('permesso')">
                                <div class="exercise-number">14</div>
                                <div class="exercise-title">Permesso</div>
                                <div class="exercise-preview">Chiedere giorno di permesso...</div>
                            </div>
                            <div class="exercise-card" onclick="showExercise('candidatura')">
                                <div class="exercise-number">15</div>
                                <div class="exercise-title">Candidatura</div>
                                <div class="exercise-preview">Lettera di presentazione spontanea...</div>
                            </div>
                            <div class="exercise-card" onclick="showExercise('reclamo')">
                                <div class="exercise-number">16</div>
                                <div class="exercise-title">Reclamo</div>
                                <div class="exercise-preview">Lamentela per servizio hotel...</div>
                            </div>
                        </div>
                    </div>

                    <div class="topic-group">
                        <div class="topic-group-title">üè† Vita quotidiana</div>
                        <div class="exercise-grid">
                            <div class="exercise-card" onclick="showExercise('disdetta')">
                                <div class="exercise-number">17</div>
                                <div class="exercise-title">Disdetta</div>
                                <div class="exercise-preview">Disdire abbonamento palestra...</div>
                            </div>
                            <div class="exercise-card" onclick="showExercise('rimborso')">
                                <div class="exercise-number">18</div>
                                <div class="exercise-title">Rimborso</div>
                                <div class="exercise-preview">Prodotto difettoso acquistato online...</div>
                            </div>
                            <div class="exercise-card" onclick="showExercise('prenotazione')">
                                <div class="exercise-number">19</div>
                                <div class="exercise-title">Prenotazione</div>
                                <div class="exercise-preview">Tavolo ristorante per evento speciale...</div>
                            </div>
                        </div>
                    </div>

                    <div class="topic-group">
                        <div class="topic-group-title">üè• Servizi Pubblici</div>
                        <div class="exercise-grid">
                            <div class="exercise-card" onclick="showExercise('medico')">
                                <div class="exercise-number">20</div>
                                <div class="exercise-title">Appuntamento medico</div>
                                <div class="exercise-preview">Spostare appuntamento specialista...</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Modal per esercizi -->
                <div id="exerciseModal" class="modal" style="display: none;">
                    <div class="modal-content">
                        <span class="close" onclick="closeModal()">&times;</span>
                        <div id="exerciseContent"></div>
                        <div class="modal-actions">
                            <button class="practice-btn" onclick="startWriting()">‚úçÔ∏è Inizia a Scrivere</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentStep = 0;
        let userText = '';
        let wordCount = 0;

        function startPractice() {
            showGuidedPractice();
        }

        function startPractice2() {
            showEmailPractice();
        }

        function showGuidedPractice() {
            const modal = document.getElementById('exerciseModal');
            const content = document.getElementById('exerciseContent');
            
            content.innerHTML = `
                <div class="exercise-content">
                    <h3>üéØ Esercitazione Guidata - Prova 1</h3>
                    <div style="background: #e8f4fd; padding: 15px; border-radius: 8px; margin: 15px 0;">
                        <strong>Traccia:</strong> Racconta come hai affrontato il tuo primo giorno in una nuova scuola o universit√†. 
                        Spiega le tue emozioni e se sei soddisfatto/a di come ti sei comportato/a.
                    </div>
                    
                    <div id="guidedSteps">
                        <div class="step-container">
                            <div style="background: #27ae60; color: white; padding: 10px; border-radius: 5px; margin-bottom: 15px; text-align: center;">
                                <strong>PASSO 1/4: Pianificazione (2 minuti)</strong>
                            </div>
                            <div style="background: #f8f9fa; padding: 15px; border-radius: 5px;">
                                <p><strong>Prima di scrivere, rispondi mentalmente a queste domande:</strong></p>
                                <ul style="line-height: 1.6;">
                                    <li>üè´ Quale scuola/universit√†? Quando √® successo?</li>
                                    <li>üò∞ Come ti sentivi prima di entrare?</li>
                                    <li>üë• Cosa hai fatto per socializzare?</li>
                                    <li>üìö Ci sono stati problemi pratici (orari, aule)?</li>
                                    <li>ü§î Cosa pensi ora di quel giorno?</li>
                                </ul>
                                <div style="text-align: center; margin-top: 15px;">
                                    <button onclick="nextStep()" style="background: #27ae60; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">
                                        Continua al Passo 2 ‚Üí
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            modal.style.display = 'flex';
            currentStep = 1;
        }

        function nextStep() {
            const stepsContainer = document.getElementById('guidedSteps');
            currentStep++;
            
            if (currentStep === 2) {
                stepsContainer.innerHTML = `
                    <div class="step-container">
                        <div style="background: #3498db; color: white; padding: 10px; border-radius: 5px; margin-bottom: 15px; text-align: center;">
                            <strong>PASSO 2/4: Struttura del Testo</strong>
                        </div>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 5px;">
                            <p><strong>Il tuo testo deve avere questa struttura:</strong></p>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 15px 0;">
                                <div style="background: white; padding: 12px; border-left: 4px solid #e74c3c; border-radius: 5px;">
                                    <strong>Paragrafo 1 (40-50 parole)</strong><br>
                                    <small>Situazione iniziale: quando, dove, perch√© eri nervoso/a</small>
                                </div>
                                <div style="background: white; padding: 12px; border-left: 4px solid #f39c12; border-radius: 5px;">
                                    <strong>Paragrafo 2 (50-60 parole)</strong><br>
                                    <small>Azioni: cosa hai fatto, come ti sei comportato/a</small>
                                </div>
                                <div style="background: white; padding: 12px; border-left: 4px solid #27ae60; border-radius: 5px;">
                                    <strong>Paragrafo 3 (30-40 parole)</strong><br>
                                    <small>Riflessione: sei soddisfatto/a? Cosa hai imparato?</small>
                                </div>
                            </div>
                            <div style="text-align: center; margin-top: 15px;">
                                <button onclick="nextStep()" style="background: #3498db; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">
                                    Inizia a Scrivere ‚Üí
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            } else if (currentStep === 3) {
                stepsContainer.innerHTML = `
                    <div class="step-container">
                        <div style="background: #9b59b6; color: white; padding: 10px; border-radius: 5px; margin-bottom: 15px; text-align: center;">
                            <strong>PASSO 3/4: Scrivi il Tuo Testo</strong>
                        </div>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 5px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <strong>Scrivi qui il tuo testo:</strong>
                                <div id="wordCounter" style="background: #3498db; color: white; padding: 5px 10px; border-radius: 15px; font-size: 0.9em;">
                                    Parole: 0/120
                                </div>
                            </div>
                            <textarea id="userTextArea" 
                                placeholder="Il mio primo giorno all'universit√† √® stato..." 
                                style="width: 100%; height: 200px; padding: 15px; border: 2px solid #ddd; border-radius: 8px; font-family: inherit; font-size: 1em; line-height: 1.5; resize: vertical;"
                                oninput="updateWordCount()"></textarea>
                            
                            <div style="background: #fff3cd; border-left: 4px solid #ffc107; padding: 10px; margin: 15px 0; border-radius: 5px;">
                                <strong>üí° Suggerimenti mentre scrivi:</strong>
                                <ul style="margin: 5px 0; font-size: 0.9em;">
                                    <li>Usa connettivi: "Inizialmente...", "Poi...", "Alla fine..."</li>
                                    <li>Varia i tempi: passato prossimo, imperfetto, presente</li>
                                    <li>Sii specifico: nomi, luoghi, emozioni precise</li>
                                </ul>
                            </div>
                            
                            <div style="text-align: center; margin-top: 15px;">
                                <button onclick="nextStep()" style="background: #9b59b6; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">
                                    Analizza il Testo ‚Üí
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            } else if (currentStep === 4) {
                analyzeText();
            }
        }

        function updateWordCount() {
            const textarea = document.getElementById('userTextArea');
            const counter = document.getElementById('wordCounter');
            
            if (textarea && counter) {
                const text = textarea.value.trim();
                wordCount = text === '' ? 0 : text.split(/\s+/).length;
                userText = text;
                
                let color = '#3498db';
                if (wordCount < 100) color = '#e74c3c';
                else if (wordCount > 120) color = '#f39c12';
                else color = '#27ae60';
                
                counter.style.backgroundColor = color;
                counter.textContent = `Parole: ${wordCount}/120`;
            }
        }

        function analyzeText() {
            const stepsContainer = document.getElementById('guidedSteps');
            const text = userText;
            
            // Analisi semplice del testo
            const hasIntroduction = text.toLowerCase().includes('primo') || text.toLowerCase().includes('inizial') || text.toLowerCase().includes('giorno');
            const hasActions = text.includes('ho') || text.includes('sono') || text.includes('mi sono');
            const hasReflection = text.toLowerCase().includes('soddisf') || text.toLowerCase().includes('pens') || text.toLowerCase().includes('imparato');
            const hasConnectives = text.includes('poi') || text.includes('dopo') || text.includes('alla fine') || text.includes('inoltre');
            
            let score = 0;
            let feedback = [];
            
            if (wordCount >= 100 && wordCount <= 120) {
                score += 25;
                feedback.push('‚úÖ Lunghezza perfetta (100-120 parole)');
            } else if (wordCount < 100) {
                feedback.push('‚ö†Ô∏è Testo troppo breve, aggiungi dettagli');
            } else {
                feedback.push('‚ö†Ô∏è Testo troppo lungo, riduci alcune parti');
            }
            
            if (hasIntroduction) {
                score += 25;
                feedback.push('‚úÖ Buona introduzione della situazione');
            } else {
                feedback.push('‚ùå Manca una chiara introduzione della situazione');
            }
            
            if (hasActions) {
                score += 25;
                feedback.push('‚úÖ Descrizione delle azioni intraprese');
            } else {
                feedback.push('‚ùå Descrivi meglio cosa hai fatto');
            }
            
            if (hasReflection) {
                score += 25;
                feedback.push('‚úÖ Buona riflessione personale');
            } else {
                feedback.push('‚ùå Aggiungi una riflessione: sei soddisfatto/a?');
            }
            
            if (hasConnectives) {
                feedback.push('‚úÖ Uso di connettivi temporali');
            } else {
                feedback.push('üí° Usa pi√π connettivi: poi, dopo, alla fine...');
            }
            
            let level = 'Insufficiente';
            let color = '#e74c3c';
            if (score >= 75) { level = 'Eccellente'; color = '#27ae60'; }
            else if (score >= 50) { level = 'Buono'; color = '#f39c12'; }
            else if (score >= 25) { level = 'Sufficiente'; color = '#3498db'; }
            
            stepsContainer.innerHTML = `
                <div class="step-container">
                    <div style="background: ${color}; color: white; padding: 10px; border-radius: 5px; margin-bottom: 15px; text-align: center;">
                        <strong>PASSO 4/4: Analisi del Tuo Testo</strong>
                    </div>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 5px;">
                        <div style="text-align: center; margin-bottom: 20px;">
                            <div style="background: ${color}; color: white; padding: 15px; border-radius: 10px; display: inline-block;">
                                <h3 style="margin: 0;">Valutazione: ${level}</h3>
                                <div style="font-size: 1.2em; margin-top: 5px;">Punteggio: ${score}/100</div>
                            </div>
                        </div>
                        
                        <div style="background: white; padding: 15px; border-radius: 8px; margin: 15px 0;">
                            <strong>üìä Feedback Dettagliato:</strong>
                            <ul style="margin: 10px 0; line-height: 1.6;">
                                ${feedback.map(item => `<li>${item}</li>`).join('')}
                            </ul>
                        </div>
                        
                        <div style="background: #e8f5e8; border-left: 4px solid #27ae60; padding: 15px; margin: 15px 0; border-radius: 5px;">
                            <strong>üéØ Prossimi Passi:</strong>
                            <p style="margin: 5px 0;">
                                ${score >= 75 ? 'Ottimo lavoro! Continua a praticare con altre tracce per mantenere questo livello.' :
                                  score >= 50 ? 'Buon lavoro! Concentrati sui punti mancanti e riprova.' :
                                  'Rileggi gli esempi e riprova. Ricorda la struttura: situazione ‚Üí azioni ‚Üí riflessione.'}
                            </p>
                        </div>
                        
                        <div style="text-align: center; margin-top: 20px;">
                            <button onclick="closeModal()" style="background: #27ae60; color: white; border: none; padding: 12px 25px; border-radius: 5px; cursor: pointer; margin-right: 10px;">
                                Chiudi
                            </button>
                            <button onclick="startPractice()" style="background: #3498db; color: white; border: none; padding: 12px 25px; border-radius: 5px; cursor: pointer;">
                                Riprova
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function showEmailPractice() {
            const modal = document.getElementById('exerciseModal');
            const content = document.getElementById('exerciseContent');
            
            content.innerHTML = `
                <div class="exercise-content">
                    <h3>üìß Esercitazione Guidata - Prova 2</h3>
                    <div style="background: #e8f4fd; padding: 15px; border-radius: 8px; margin: 15px 0;">
                        <strong>Situazione:</strong> Hai un appuntamento importante dal dentista domani alle 14:00, 
                        ma il tuo capo ti ha appena comunicato una riunione urgente alla stessa ora. 
                        Scrivi una email al dentista per spostare l'appuntamento.
                    </div>
                    
                    <div id="emailSteps">
                        <div class="step-container">
                            <div style="background: #3498db; color: white; padding: 10px; border-radius: 5px; margin-bottom: 15px; text-align: center;">
                                <strong>PASSO 1/3: Struttura Email Formale</strong>
                            </div>
                            <div style="background: #f8f9fa; padding: 15px; border-radius: 5px;">
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                                    <div style="background: white; padding: 12px; border-left: 4px solid #3498db; border-radius: 5px;">
                                        <strong>1. Oggetto</strong><br>
                                        <small>Chiaro e specifico</small><br>
                                        <em>Es: "Richiesta spostamento appuntamento"</em>
                                    </div>
                                    <div style="background: white; padding: 12px; border-left: 4px solid #27ae60; border-radius: 5px;">
                                        <strong>2. Saluto</strong><br>
                                        <small>Formale</small><br>
                                        <em>Es: "Gentile Dottor Rossi"</em>
                                    </div>
                                    <div style="background: white; padding: 12px; border-left: 4px solid #f39c12; border-radius: 5px;">
                                        <strong>3. Corpo</strong><br>
                                        <small>Scuse + Motivo + Richiesta</small><br>
                                        <em>Breve ma completo</em>
                                    </div>
                                    <div style="background: white; padding: 12px; border-left: 4px solid #9b59b6; border-radius: 5px;">
                                        <strong>4. Chiusura</strong><br>
                                        <small>Formula cortese + Firma</small><br>
                                        <em>Es: "Cordiali saluti"</em>
                                    </div>
                                </div>
                                <div style="text-align: center; margin-top: 15px;">
                                    <button onclick="nextEmailStep()" style="background: #3498db; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">
                                        Continua ‚Üí
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            modal.style.display = 'flex';
            currentStep = 1;
        }

        function nextEmailStep() {
            const stepsContainer = document.getElementById('emailSteps');
            currentStep++;
            
            if (currentStep === 2) {
                stepsContainer.innerHTML = `
                    <div class="step-container">
                        <div style="background: #27ae60; color: white; padding: 10px; border-radius: 5px; margin-bottom: 15px; text-align: center;">
                            <strong>PASSO 2/3: Scrivi la Tua Email</strong>
                        </div>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 5px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <strong>Componi la tua email:</strong>
                                <div id="emailWordCounter" style="background: #3498db; color: white; padding: 5px 10px; border-radius: 15px; font-size: 0.9em;">
                                    Parole: 0/80
                                </div>
                            </div>
                            
                            <div style="background: white; border: 2px solid #ddd; border-radius: 8px; padding: 15px; margin-bottom: 15px;">
                                <div style="margin-bottom: 10px;">
                                    <strong>Oggetto:</strong>
                                    <input type="text" id="emailSubject" placeholder="Scrivi l'oggetto..." 
                                           style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; margin-top: 5px;">
                                </div>
                                
                                <textarea id="emailTextArea" 
                                    placeholder="Gentile Dottor Rossi,&#10;&#10;Le scrivo per..." 
                                    style="width: 100%; height: 150px; padding: 15px; border: 1px solid #ddd; border-radius: 4px; font-family: inherit; font-size: 1em; line-height: 1.5; resize: vertical;"
                                    oninput="updateEmailWordCount()"></textarea>
                            </div>
                            
                            <div style="background: #fff3cd; border-left: 4px solid #ffc107; padding: 10px; margin: 15px 0; border-radius: 5px;">
                                <strong>üí° Checklist:</strong>
                                <div style="font-size: 0.9em; margin-top: 5px;">
                                    ‚úì Usa "Lei" (non "tu")<br>
                                    ‚úì Spiega brevemente il motivo<br>
                                    ‚úì Proponi alternative concrete<br>
                                    ‚úì Mantieni tono rispettoso
                                </div>
                            </div>
                            
                            <div style="text-align: center; margin-top: 15px;">
                                <button onclick="nextEmailStep()" style="background: #27ae60; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">
                                    Analizza Email ‚Üí
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            } else if (currentStep === 3) {
                analyzeEmail();
            }
        }

        function updateEmailWordCount() {
            const textarea = document.getElementById('emailTextArea');
            const counter = document.getElementById('emailWordCounter');
            
            if (textarea && counter) {
                const text = textarea.value.trim();
                wordCount = text === '' ? 0 : text.split(/\s+/).length;
                userText = text;
                
                let color = '#3498db';
                if (wordCount < 50) color = '#e74c3c';
                else if (wordCount > 80) color = '#f39c12';
                else color = '#27ae60';
                
                counter.style.backgroundColor = color;
                counter.textContent = `Parole: ${wordCount}/80`;
            }
        }

        function analyzeEmail() {
            const stepsContainer = document.getElementById('emailSteps');
            const text = userText;
            const subject = document.getElementById('emailSubject')?.value || '';
            
            // Analisi email
            const hasFormalGreeting = text.toLowerCase().includes('gentile') || text.toLowerCase().includes('egregio');
            const hasApology = text.toLowerCase().includes('scus') || text.toLowerCase().includes('dispiace');
            const hasExplanation = text.toLowerCase().includes('riunione') || text.toLowerCase().includes('lavoro') || text.toLowerCase().includes('impegno');
            const hasRequest = text.toLowerCase().includes('spostare') || text.toLowerCase().includes('rimandare') || text.toLowerCase().includes('nuovo');
            const hasFormalClosing = text.toLowerCase().includes('cordiali') || text.toLowerCase().includes('distinti');
            const usesFormalRegister = text.includes('Lei') || text.includes('La ') || !text.toLowerCase().includes(' tu ');
            
            let score = 0;
            let feedback = [];
            
            if (subject.length > 5) {
                score += 15;
                feedback.push('‚úÖ Oggetto presente e appropriato');
            } else {
                feedback.push('‚ùå Oggetto mancante o troppo breve');
            }
            
            if (wordCount >= 50 && wordCount <= 80) {
                score += 15;
                feedback.push('‚úÖ Lunghezza appropriata (50-80 parole)');
            } else if (wordCount < 50) {
                feedback.push('‚ö†Ô∏è Email troppo breve, aggiungi dettagli');
            } else {
                feedback.push('‚ö†Ô∏è Email troppo lunga, sii pi√π conciso');
            }
            
            if (hasFormalGreeting) {
                score += 15;
                feedback.push('‚úÖ Saluto formale corretto');
            } else {
                feedback.push('‚ùå Manca saluto formale (Gentile/Egregio + titolo)');
            }
            
            if (hasApology) {
                score += 15;
                feedback.push('‚úÖ Scuse appropriate');
            } else {
                feedback.push('‚ùå Mancano le scuse per l\'inconveniente');
            }
            
            if (hasExplanation) {
                score += 15;
                feedback.push('‚úÖ Spiegazione del motivo');
            } else {
                feedback.push('‚ùå Spiega meglio il motivo dello spostamento');
            }
            
            if (hasRequest) {
                score += 15;
                feedback.push('‚úÖ Richiesta chiara di nuovo appuntamento');
            } else {
                feedback.push('‚ùå Manca richiesta esplicita di nuovo appuntamento');
            }
            
            if (hasFormalClosing) {
                score += 10;
                feedback.push('‚úÖ Chiusura formale appropriata');
            } else {
                feedback.push('‚ùå Manca formula di chiusura formale');
            }
            
            if (usesFormalRegister) {
                feedback.push('‚úÖ Registro formale mantenuto');
            } else {
                feedback.push('‚ùå Usa il "Lei" formale, non il "tu"');
            }
            
            let level = 'Insufficiente';
            let color = '#e74c3c';
            if (score >= 80) { level = 'Eccellente'; color = '#27ae60'; }
            else if (score >= 60) { level = 'Buono'; color = '#f39c12'; }
            else if (score >= 40) { level = 'Sufficiente'; color = '#3498db'; }
            
            stepsContainer.innerHTML = `
                <div class="step-container">
                    <div style="background: ${color}; color: white; padding: 10px; border-radius: 5px; margin-bottom: 15px; text-align: center;">
                        <strong>PASSO 3/3: Analisi della Tua Email</strong>
                    </div>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 5px;">
                        <div style="text-align: center; margin-bottom: 20px;">
                            <div style="background: ${color}; color: white; padding: 15px; border-radius: 10px; display: inline-block;">
                                <h3 style="margin: 0;">Valutazione: ${level}</h3>
                                <div style="font-size: 1.2em; margin-top: 5px;">Punteggio: ${score}/100</div>
                            </div>
                        </div>
                        
                        <div style="background: white; padding: 15px; border-radius: 8px; margin: 15px 0;">
                            <strong>üìä Feedback Dettagliato:</strong>
                            <ul style="margin: 10px 0; line-height: 1.6;">
                                ${feedback.map(item => `<li>${item}</li>`).join('')}
                            </ul>
                        </div>
                        
                        <div style="background: #e8f5e8; border-left: 4px solid #27ae60; padding: 15px; margin: 15px 0; border-radius: 5px;">
                            <strong>üéØ Suggerimenti:</strong>
                            <p style="margin: 5px 0;">
                                ${score >= 80 ? 'Perfetto! La tua email √® professionale e completa.' :
                                  score >= 60 ? 'Buon lavoro! Migliora i punti mancanti per raggiungere l\'eccellenza.' :
                                  'Rileggi la struttura delle email formali e riprova. Ricorda: saluto ‚Üí scuse ‚Üí spiegazione ‚Üí richiesta ‚Üí chiusura.'}
                            </p>
                        </div>
                        
                        <div style="text-align: center; margin-top: 20px;">
                            <button onclick="closeModal()" style="background: #27ae60; color: white; border: none; padding: 12px 25px; border-radius: 5px; cursor: pointer; margin-right: 10px;">
                                Chiudi
                            </button>
                            <button onclick="startPractice2()" style="background: #3498db; color: white; border: none; padding: 12px 25px; border-radius: 5px; cursor: pointer;">
                                Riprova
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        const exercises = {
            'trasloco': {
                title: 'Trasloco in Nuova Citt√†',
                type: 'Prova 1 (120-140 parole)',
                consegna: 'Racconta come hai organizzato un trasloco in una nuova citt√† per motivi di studio o lavoro. Spiega le difficolt√† che hai incontrato e come le hai superate. Sei soddisfatto/a di come hai gestito questa situazione?'
            },
            'primo-lavoro': {
                title: 'Primo Giorno di Lavoro',
                type: 'Prova 1 (120-140 parole)',
                consegna: 'Descrivi la tua esperienza nel primo giorno di un nuovo lavoro importante. Racconta le tue emozioni, le difficolt√† incontrate e come ti sei ambientato/a. Sei soddisfatto/a di come hai affrontato questa nuova sfida?'
            },
            'evento': {
                title: 'Organizzazione di un Evento',
                type: 'Prova 1 (120-140 parole)',
                consegna: 'Racconta di quando hai dovuto organizzare una festa di compleanno importante per un familiare o amico. Spiega come hai gestito i preparativi e se sei soddisfatto/a del risultato ottenuto.'
            },
            'decisione': {
                title: 'Decisione Importante',
                type: 'Prova 1 (120-140 parole)',
                consegna: 'Racconta di una volta in cui hai dovuto scegliere tra due opportunit√† importanti (lavoro, studio, relazione). Spiega come hai preso la decisione e se sei soddisfatto/a della scelta fatta.'
            },
            'emergenza': {
                title: 'Emergenza Medica',
                type: 'Prova 1 (120-140 parole)',
                consegna: 'Racconta di quando un familiare o amico si √® sentito male improvvisamente e tu hai dovuto gestire l\'emergenza. Spiega come hai reagito e se sei soddisfatto/a del tuo comportamento in quella situazione.'
            },
            'tecnologia': {
                title: 'Problema Tecnologico',
                type: 'Prova 1 (120-140 parole)',
                consegna: 'Il tuo computer si √® rotto proprio prima di una presentazione o esame importante. Racconta come hai risolto il problema e se sei soddisfatto/a della soluzione trovata.'
            },
            'sciopero': {
                title: 'Sciopero dei Trasporti',
                type: 'Prova 1 (120-140 parole)',
                consegna: 'Dovevi arrivare a un appuntamento cruciale (colloquio, esame, matrimonio) ma c\'era sciopero dei trasporti. Racconta come hai gestito la situazione e se sei soddisfatto/a delle tue scelte.'
            },
            'maltempo': {
                title: 'Maltempo Improvviso',
                type: 'Prova 1 (120-140 parole)',
                consegna: 'Un temporale o maltempo improvviso ha rovinato i tuoi piani per un evento all\'aperto importante. Racconta come ti sei adattato alla situazione e se sei soddisfatto/a delle soluzioni trovate.'
            },
            'paura': {
                title: 'Superare una Paura',
                type: 'Prova 1 (120-140 parole)',
                consegna: 'Racconta di quando hai dovuto affrontare una tua grande paura (parlare in pubblico, volare, altezze, ecc.) per un motivo importante. Spiega come hai fatto e se sei soddisfatto/a del tuo coraggio.'
            },
            'obiettivo': {
                title: 'Obiettivo Raggiunto',
                type: 'Prova 1 (120-140 parole)',
                consegna: 'Descrivi come hai raggiunto un traguardo personale che sembrava impossibile (diploma, patente, gara sportiva, perdere peso). Racconta le difficolt√† e se sei soddisfatto/a del percorso fatto.'
            },
            'tesi': {
                title: 'Ritardo Consegna Tesi',
                type: 'Prova 2 (80-120 parole)',
                consegna: 'Scrivi una email al tuo relatore di tesi per chiedere una proroga di due settimane per la consegna a causa di problemi personali gravi. Scusati per l\'inconveniente e spiega dettagliatamente la situazione.'
            },
            'certificato': {
                title: 'Richiesta Certificato',
                type: 'Prova 2 (80-120 parole)',
                consegna: 'Scrivi una email alla segreteria universitaria per richiedere urgentemente un certificato di iscrizione necessario per una domanda di borsa di studio. La scadenza √® tra tre giorni e spiega l\'importanza di questa opportunit√†.'
            },
            'cambio-corso': {
                title: 'Cambio Corso di Laurea',
                type: 'Prova 2 (80-120 parole)',
                consegna: 'Scrivi una lettera formale per chiedere il trasferimento dal tuo corso attuale a Economia perch√© hai scoperto una maggiore passione per questa materia. Spiega dettagliatamente le tue motivazioni e il tuo percorso di riflessione.'
            },
            'permesso': {
                title: 'Richiesta Permesso',
                type: 'Prova 2 (80-120 parole)',
                consegna: 'Scrivi una email al tuo capo per chiedere un giorno di permesso urgente domani perch√© tua madre deve fare un\'operazione e hai bisogno di accompagnarla in ospedale. Spiega la situazione e proponi come recuperare il lavoro.'
            },
            'candidatura': {
                title: 'Candidatura Spontanea',
                type: 'Prova 2 (80-120 parole)',
                consegna: 'Scrivi una lettera di presentazione per candidarti spontaneamente in un\'azienda di marketing che ti interessa molto. Presenta dettagliatamente le tue competenze, la tua formazione e la tua motivazione specifica per questa azienda.'
            },
            'reclamo': {
                title: 'Reclamo Servizio Hotel',
                type: 'Prova 2 (80-120 parole)',
                consegna: 'Scrivi una email di lamentela alla direzione di un hotel dove hai soggiornato. La camera era sporca, l\'aria condizionata non funzionava e il personale era scortese. Descrivi ogni problema in dettaglio e chiedi un rimborso parziale.'
            },
            'disdetta': {
                title: 'Disdetta Abbonamento',
                type: 'Prova 2 (80-120 parole)',
                consegna: 'Scrivi una lettera per disdire il tuo abbonamento annuale in palestra perch√© ti trasferisci in un\'altra citt√† per lavoro. Spiega la situazione, esprimi il tuo dispiacere e chiedi informazioni dettagliate sulle modalit√† di rimborso per i mesi non utilizzati.'
            },
            'rimborso': {
                title: 'Richiesta Rimborso',
                type: 'Prova 2 (80-120 parole)',
                consegna: 'Scrivi una email per chiedere il rimborso di uno smartphone acquistato online che √® arrivato con lo schermo rotto. Descrivi il problema in dettaglio, menciona che hai le foto del danno e spiega perch√© vuoi la sostituzione o il rimborso completo.'
            },
            'prenotazione': {
                title: 'Prenotazione Ristorante',
                type: 'Prova 2 (80-120 parole)',
                consegna: 'Scrivi una email formale per prenotare un tavolo per 8 persone per il tuo anniversario di matrimonio. Spiega l\'importanza dell\'occasione, specifica che hai bisogno di un tavolo appartato, men√π vegetariano per due persone e una torta personalizzata.'
            },
            'medico': {
                title: 'Spostare Appuntamento Medico',
                type: 'Prova 2 (80-120 parole)',
                consegna: 'Scrivi una lettera per spostare il tuo appuntamento dal cardiologo da marted√¨ a gioved√¨ della stessa settimana a causa di un impegno lavorativo improvviso e urgente che non puoi rimandare. Spiega l\'importanza di entrambi gli impegni e scusati per l\'inconveniente.'
            }
        };

        function showExercise(exerciseId) {
            const exercise = exercises[exerciseId];
            if (!exercise) return;

            const modal = document.getElementById('exerciseModal');
            const content = document.getElementById('exerciseContent');
            
            content.innerHTML = `
                <div class="exercise-content">
                    <h3>${exercise.title}</h3>
                    <div style="background: #e8f4fd; padding: 10px; border-radius: 5px; margin: 15px 0; text-align: center; font-weight: bold; color: #2c3e50;">
                        ${exercise.type}
                    </div>
                    <div class="consegna">
                        ${exercise.consegna}
                    </div>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 5px; margin: 15px 0;">
                        <strong>üí° Suggerimento:</strong> ${exercise.type.includes('Prova 1') ? 
                            'Ricorda di strutturare il testo con: situazione iniziale ‚Üí azioni intraprese ‚Üí riflessione personale. Usa connettivi temporali e varia i tempi verbali.' : 
                            'Mantieni un registro formale, includi saluto e chiusura appropriati. Sii conciso ma completo nella spiegazione.'}
                    </div>
                </div>
            `;
            
            modal.style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('exerciseModal').style.display = 'none';
        }

        function startWriting() {
            const modal = document.getElementById('exerciseModal');
            const content = document.getElementById('exerciseContent');
            
            // Get current exercise info
            const exerciseTitle = content.querySelector('h3').textContent;
            const exerciseType = content.querySelector('div[style*="background: #e8f4fd"]').textContent.trim();
            const consegna = content.querySelector('.consegna').textContent;
            
            const isProva1 = exerciseType.includes('Prova 1');
            const wordLimit = isProva1 ? '120-140' : '80-120';
            const maxWords = isProva1 ? 140 : 120;
            const minWords = isProva1 ? 120 : 80;
            
            content.innerHTML = `
                <div class="exercise-content">
                    <h3>‚úçÔ∏è ${exerciseTitle}</h3>
                    <div style="background: #e8f4fd; padding: 10px; border-radius: 5px; margin: 15px 0; text-align: center; font-weight: bold; color: #2c3e50;">
                        ${exerciseType}
                    </div>
                    
                    <div class="consegna" style="margin-bottom: 20px;">
                        <strong>Traccia:</strong> ${consegna}
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <strong>Scrivi il tuo testo:</strong>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <div id="liveWordCounter" style="background: #3498db; color: white; padding: 5px 12px; border-radius: 15px; font-size: 0.9em; font-weight: bold;">
                                    Parole: 0/${wordLimit}
                                </div>
                                <button onclick="clearText()" style="background: #e74c3c; color: white; border: none; padding: 5px 10px; border-radius: 12px; font-size: 0.8em; cursor: pointer;">
                                    üóëÔ∏è Cancella
                                </button>
                            </div>
                        </div>
                        
                        ${isProva1 ? `
                        <textarea id="writingArea" 
                            placeholder="Inizia a scrivere qui il tuo testo narrativo...&#10;&#10;Ricorda la struttura:&#10;1. Situazione iniziale (quando, dove, perch√©)&#10;2. Azioni intraprese (cosa hai fatto)&#10;3. Riflessione personale (sei soddisfatto/a?)" 
                            style="width: 100%; height: 250px; padding: 15px; border: 2px solid #ddd; border-radius: 8px; font-family: inherit; font-size: 1em; line-height: 1.6; resize: vertical;"
                            oninput="updateLiveWordCount(${minWords}, ${maxWords})"></textarea>
                        ` : `
                        <div style="margin-bottom: 15px;">
                            <label style="font-weight: bold; display: block; margin-bottom: 5px;">Oggetto (per email):</label>
                            <input type="text" id="emailSubjectField" placeholder="Es: Richiesta spostamento appuntamento" 
                                   style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        <textarea id="writingArea" 
                            placeholder="Gentile Dottore/Professoressa [Cognome],&#10;&#10;Le scrivo per...&#10;&#10;[Spiegazione del problema]&#10;&#10;[Richiesta specifica]&#10;&#10;La ringrazio per la comprensione.&#10;&#10;Cordiali saluti,&#10;[Il tuo nome]" 
                            style="width: 100%; height: 200px; padding: 15px; border: 2px solid #ddd; border-radius: 8px; font-family: inherit; font-size: 1em; line-height: 1.6; resize: vertical;"
                            oninput="updateLiveWordCount(${minWords}, ${maxWords})"></textarea>
                        `}
                        
                        <div id="writingTips" style="background: #fff3cd; border-left: 4px solid #ffc107; padding: 12px; margin: 15px 0; border-radius: 5px;">
                            <strong>üí° Suggerimenti in tempo reale:</strong>
                            <div id="tipsContent" style="margin-top: 8px; font-size: 0.9em; line-height: 1.5;">
                                Inizia a scrivere per ricevere suggerimenti personalizzati...
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 10px; justify-content: center; margin-top: 20px;">
                            <button onclick="analyzeWriting()" style="background: #27ae60; color: white; border: none; padding: 12px 25px; border-radius: 8px; cursor: pointer; font-weight: bold;">
                                üìä Analizza Testo
                            </button>
                            <button onclick="showExampleSolution()" style="background: #3498db; color: white; border: none; padding: 12px 25px; border-radius: 8px; cursor: pointer; font-weight: bold;">
                                üí° Vedi Esempio
                            </button>
                            <button onclick="closeModal()" style="background: #95a5a6; color: white; border: none; padding: 12px 25px; border-radius: 8px; cursor: pointer; font-weight: bold;">
                                ‚Üê Indietro
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function clearText() {
            const textarea = document.getElementById('writingArea');
            const emailSubject = document.getElementById('emailSubjectField');
            if (textarea) textarea.value = '';
            if (emailSubject) emailSubject.value = '';
            updateLiveWordCount(50, 140);
        }

        function updateLiveWordCount(minWords, maxWords) {
            const textarea = document.getElementById('writingArea');
            const counter = document.getElementById('liveWordCounter');
            const tipsContent = document.getElementById('tipsContent');
            
            if (!textarea || !counter) return;
            
            const text = textarea.value.trim();
            const currentWords = text === '' ? 0 : text.split(/\s+/).length;
            
            // Update counter color and text
            let color = '#3498db';
            let status = '';
            
            if (currentWords < minWords) {
                color = '#e74c3c';
                status = ` (${minWords - currentWords} parole mancanti)`;
            } else if (currentWords > maxWords) {
                color = '#f39c12';
                status = ` (${currentWords - maxWords} parole in eccesso)`;
            } else {
                color = '#27ae60';
                status = ' ‚úì';
            }
            
            counter.style.backgroundColor = color;
            counter.textContent = `Parole: ${currentWords}/${minWords}-${maxWords}${status}`;
            
            // Generate dynamic tips
            if (tipsContent) {
                let tips = [];
                
                if (currentWords === 0) {
                    tips.push("Inizia con una frase che introduce la situazione");
                } else if (currentWords < 20) {
                    tips.push("Continua descrivendo il contesto (quando, dove, perch√©)");
                } else if (currentWords < 60 && maxWords > 80) {
                    tips.push("Sviluppa le azioni che hai intrapreso");
                } else if (currentWords < 100 && maxWords > 80) {
                    tips.push("Aggiungi la tua riflessione personale");
                } else if (currentWords >= minWords && currentWords <= maxWords) {
                    tips.push("Perfetto! Rileggi per controllare grammatica e coerenza");
                }
                
                // Check for specific elements
                const lowerText = text.toLowerCase();
                if (maxWords > 80) { // Prova 1
                    if (!lowerText.includes('ho ') && !lowerText.includes('sono ')) {
                        tips.push("Usa la prima persona: 'ho fatto', 'sono andato/a'");
                    }
                    if (!lowerText.includes('poi') && !lowerText.includes('dopo') && !lowerText.includes('alla fine')) {
                        tips.push("Aggiungi connettivi temporali: poi, dopo, alla fine");
                    }
                    if (!lowerText.includes('soddisf') && !lowerText.includes('contento') && !lowerText.includes('felice')) {
                        tips.push("Non dimenticare di dire se sei soddisfatto/a del risultato");
                    }
                } else { // Prova 2
                    if (!lowerText.includes('gentile') && !lowerText.includes('egregio')) {
                        tips.push("Inizia con un saluto formale: 'Gentile' o 'Egregio'");
                    }
                    if (!lowerText.includes('scus') && !lowerText.includes('dispiace')) {
                        tips.push("Includi delle scuse appropriate per la situazione");
                    }
                    if (!lowerText.includes('cordiali') && !lowerText.includes('distinti')) {
                        tips.push("Termina con una formula di cortesia: 'Cordiali saluti'");
                    }
                    if (text.includes(' tu ') || text.includes('tuo ')) {
                        tips.push("‚ö†Ô∏è Usa il 'Lei' formale, non il 'tu'");
                    }
                }
                
                tipsContent.innerHTML = tips.length > 0 ? tips.map(tip => `‚Ä¢ ${tip}`).join('<br>') : "Ottimo lavoro! Il testo sembra ben strutturato.";
            }
        }

        function analyzeWriting() {
            const textarea = document.getElementById('writingArea');
            const emailSubject = document.getElementById('emailSubjectField');
            
            if (!textarea) return;
            
            const text = textarea.value.trim();
            const subject = emailSubject ? emailSubject.value.trim() : '';
            
            if (text.length < 10) {
                alert('Scrivi almeno qualche frase prima di analizzare il testo!');
                return;
            }
            
            // Determine if it's Prova 1 or 2
            const isProva1 = document.getElementById('emailSubjectField') === null;
            
            let analysis = analyzeTextContent(text, subject, isProva1);
            
            const modal = document.getElementById('exerciseModal');
            const content = document.getElementById('exerciseContent');
            
            content.innerHTML = `
                <div class="exercise-content">
                    <h3>üìä Analisi del Tuo Testo</h3>
                    
                    <div style="text-align: center; margin: 20px 0;">
                        <div style="background: ${analysis.color}; color: white; padding: 20px; border-radius: 15px; display: inline-block; min-width: 200px;">
                            <h2 style="margin: 0; font-size: 1.5em;">${analysis.level}</h2>
                            <div style="font-size: 1.3em; margin-top: 8px; font-weight: bold;">${analysis.score}/100</div>
                        </div>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 20px 0;">
                        <h4 style="color: #2c3e50; margin-bottom: 15px;">üìã Valutazione Dettagliata:</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                            ${analysis.criteria.map(criterion => `
                                <div style="background: white; padding: 15px; border-radius: 8px; border-left: 4px solid ${criterion.score >= 15 ? '#27ae60' : criterion.score >= 10 ? '#f39c12' : '#e74c3c'};">
                                    <div style="font-weight: bold; color: #2c3e50; margin-bottom: 8px;">${criterion.name}</div>
                                    <div style="font-size: 0.9em; color: #7f8c8d; margin-bottom: 8px;">${criterion.description}</div>
                                    <div style="font-weight: bold; color: ${criterion.score >= 15 ? '#27ae60' : criterion.score >= 10 ? '#f39c12' : '#e74c3c'};">
                                        ${criterion.score}/20 - ${criterion.feedback}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div style="background: ${analysis.score >= 70 ? '#e8f5e8' : '#fff3cd'}; border-left: 4px solid ${analysis.score >= 70 ? '#27ae60' : '#f39c12'}; padding: 15px; margin: 20px 0; border-radius: 5px;">
                        <h4 style="margin-top: 0;">üéØ Consigli per Migliorare:</h4>
                        <ul style="margin: 10px 0; line-height: 1.6;">
                            ${analysis.suggestions.map(suggestion => `<li>${suggestion}</li>`).join('')}
                        </ul>
                    </div>
                    
                    <div style="text-align: center; margin-top: 25px;">
                        <button onclick="startWriting()" style="background: #3498db; color: white; border: none; padding: 12px 25px; border-radius: 8px; cursor: pointer; font-weight: bold; margin-right: 10px;">
                            ‚úèÔ∏è Modifica Testo
                        </button>
                        <button onclick="showExampleSolution()" style="background: #27ae60; color: white; border: none; padding: 12px 25px; border-radius: 8px; cursor: pointer; font-weight: bold; margin-right: 10px;">
                            üí° Vedi Esempio
                        </button>
                        <button onclick="closeModal()" style="background: #95a5a6; color: white; border: none; padding: 12px 25px; border-radius: 8px; cursor: pointer; font-weight: bold;">
                            Chiudi
                        </button>
                    </div>
                </div>
            `;
        }

        function analyzeTextContent(text, subject, isProva1) {
            const words = text.trim() === '' ? 0 : text.trim().split(/\s+/).length;
            const lowerText = text.toLowerCase();
            
            let score = 0;
            let criteria = [];
            let suggestions = [];
            
            if (isProva1) {
                // Prova 1 Analysis
                const targetMin = 120, targetMax = 140;
                
                // Lunghezza
                let lengthScore = 0;
                let lengthFeedback = '';
                if (words >= targetMin && words <= targetMax) {
                    lengthScore = 20;
                    lengthFeedback = 'Perfetta';
                } else if (words >= 100 && words < targetMin) {
                    lengthScore = 15;
                    lengthFeedback = 'Buona, ma aggiungi dettagli';
                } else if (words > targetMax && words <= 160) {
                    lengthScore = 15;
                    lengthFeedback = 'Buona, ma riduci leggermente';
                } else {
                    lengthScore = 10;
                    lengthFeedback = words < 100 ? 'Troppo breve' : 'Troppo lunga';
                }
                
                criteria.push({
                    name: 'Lunghezza',
                    description: `${targetMin}-${targetMax} parole`,
                    score: lengthScore,
                    feedback: lengthFeedback
                });
                score += lengthScore;
                
                // Contenuto narrativo
                const hasPersonalExperience = lowerText.includes('ho ') || lowerText.includes('sono ') || lowerText.includes('mi sono');
                const hasTimeReferences = lowerText.includes('quando') || lowerText.includes('ieri') || lowerText.includes('scorso') || lowerText.includes('fa');
                let contentScore = 0;
                if (hasPersonalExperience && hasTimeReferences) {
                    contentScore = 20;
                } else if (hasPersonalExperience || hasTimeReferences) {
                    contentScore = 15;
                } else {
                    contentScore = 10;
                }
                
                criteria.push({
                    name: 'Contenuto Narrativo',
                    description: 'Esperienza personale chiara',
                    score: contentScore,
                    feedback: contentScore >= 20 ? 'Eccellente' : contentScore >= 15 ? 'Buono' : 'Da migliorare'
                });
                score += contentScore;
                
                // Struttura e organizzazione
                const hasConnectives = lowerText.includes('poi') || lowerText.includes('dopo') || lowerText.includes('alla fine') || lowerText.includes('inoltre');
                const paragraphs = text.split('\n\n').length;
                let structureScore = 0;
                if (hasConnectives && paragraphs >= 2) {
                    structureScore = 20;
                } else if (hasConnectives || paragraphs >= 2) {
                    structureScore = 15;
                } else {
                    structureScore = 10;
                }
                
                criteria.push({
                    name: 'Struttura',
                    description: 'Organizzazione e connettivi',
                    score: structureScore,
                    feedback: structureScore >= 20 ? 'Ben organizzata' : structureScore >= 15 ? 'Discreta' : 'Poco strutturata'
                });
                score += structureScore;
                
                // Riflessione personale
                const hasReflection = lowerText.includes('soddisf') || lowerText.includes('contento') || lowerText.includes('felice') || 
                                    lowerText.includes('imparato') || lowerText.includes('esperienza') || lowerText.includes('penso');
                let reflectionScore = hasReflection ? 20 : 10;
                
                criteria.push({
                    name: 'Riflessione',
                    description: 'Valutazione personale',
                    score: reflectionScore,
                    feedback: reflectionScore >= 20 ? 'Presente e chiara' : 'Mancante o superficiale'
                });
                score += reflectionScore;
                
                // Variet√† linguistica
                const hasVariedTenses = (lowerText.includes('ho ') || lowerText.includes('sono andato')) && 
                                       (lowerText.includes('ero') || lowerText.includes('stavo')) &&
                                       (lowerText.includes('ora') || lowerText.includes('adesso') || lowerText.includes('oggi'));
                let varietyScore = hasVariedTenses ? 20 : 15;
                
                criteria.push({
                    name: 'Variet√† Linguistica',
                    description: 'Tempi verbali e lessico',
                    score: varietyScore,
                    feedback: varietyScore >= 20 ? 'Ottima variet√†' : 'Discreta variet√†'
                });
                score += varietyScore;
                
                // Suggestions for Prova 1
                if (lengthScore < 20) {
                    suggestions.push(words < targetMin ? 'Aggiungi pi√π dettagli sulla situazione e le tue emozioni' : 'Riduci alcune parti per rispettare il limite di parole');
                }
                if (contentScore < 20) {
                    suggestions.push('Racconta un\'esperienza personale specifica con dettagli concreti');
                }
                if (structureScore < 20) {
                    suggestions.push('Usa pi√π connettivi temporali (poi, dopo, alla fine) e dividi in paragrafi');
                }
                if (reflectionScore < 20) {
                    suggestions.push('Aggiungi una riflessione: sei soddisfatto/a? Cosa hai imparato?');
                }
                if (!hasVariedTenses) {
                    suggestions.push('Varia i tempi verbali: passato prossimo, imperfetto, presente');
                }
                
            } else {
                // Prova 2 Analysis
                const targetMin = 50, targetMax = 80;
                
                // Lunghezza
                let lengthScore = 0;
                if (words >= targetMin && words <= targetMax) {
                    lengthScore = 20;
                } else if (words >= 40 && words < targetMin) {
                    lengthScore = 15;
                } else if (words > targetMax && words <= 90) {
                    lengthScore = 15;
                } else {
                    lengthScore = 10;
                }
                
                criteria.push({
                    name: 'Lunghezza',
                    description: `${targetMin}-${targetMax} parole`,
                    score: lengthScore,
                    feedback: lengthScore >= 20 ? 'Perfetta' : lengthScore >= 15 ? 'Accettabile' : words < targetMin ? 'Troppo breve' : 'Troppo lunga'
                });
                score += lengthScore;
                
                // Registro formale
                const hasFormalGreeting = lowerText.includes('gentile') || lowerText.includes('egregio');
                const usesFormalRegister = !lowerText.includes(' tu ') && !lowerText.includes('tuo ') && !lowerText.includes('ciao');
                const hasFormalClosing = lowerText.includes('cordiali') || lowerText.includes('distinti');
                let formalScore = 0;
                if (hasFormalGreeting && usesFormalRegister && hasFormalClosing) {
                    formalScore = 20;
                } else if ((hasFormalGreeting && usesFormalRegister) || (usesFormalRegister && hasFormalClosing)) {
                    formalScore = 15;
                } else {
                    formalScore = 10;
                }
                
                criteria.push({
                    name: 'Registro Formale',
                    description: 'Saluto, Lei, chiusura',
                    score: formalScore,
                    feedback: formalScore >= 20 ? 'Perfetto' : formalScore >= 15 ? 'Buono' : 'Da migliorare'
                });
                score += formalScore;
                
                // Contenuto completo
                const hasApology = lowerText.includes('scus') || lowerText.includes('dispiace') || lowerText.includes('spiacente');
                const hasExplanation = text.length > 100; // Basic check for explanation
                const hasRequest = lowerText.includes('chiedo') || lowerText.includes('potrebbe') || lowerText.includes('sarebbe possibile');
                let contentScore = 0;
                if (hasApology && hasExplanation && hasRequest) {
                    contentScore = 20;
                } else if ((hasApology && hasExplanation) || (hasExplanation && hasRequest)) {
                    contentScore = 15;
                } else {
                    contentScore = 10;
                }
                
                criteria.push({
                    name: 'Contenuto',
                    description: 'Scuse, spiegazione, richiesta',
                    score: contentScore,
                    feedback: contentScore >= 20 ? 'Completo' : contentScore >= 15 ? 'Quasi completo' : 'Incompleto'
                });
                score += contentScore;
                
                // Oggetto (se email)
                let subjectScore = 20;
                if (subject.length === 0) {
                    subjectScore = 10;
                } else if (subject.length < 5) {
                    subjectScore = 15;
                }
                
                criteria.push({
                    name: 'Oggetto',
                    description: 'Chiaro e appropriato',
                    score: subjectScore,
                    feedback: subjectScore >= 20 ? 'Appropriato' : subjectScore >= 15 ? 'Accettabile' : 'Mancante o inadeguato'
                });
                score += subjectScore;
                
                // Cortesia
                const hasCourtesy = lowerText.includes('grazie') || lowerText.includes('ringrazio') || lowerText.includes('comprensione');
                let courtesyScore = hasCourtesy ? 20 : 15;
                
                criteria.push({
                    name: 'Cortesia',
                    description: 'Formule di cortesia',
                    score: courtesyScore,
                    feedback: courtesyScore >= 20 ? 'Molto cortese' : 'Sufficientemente cortese'
                });
                score += courtesyScore;
                
                // Suggestions for Prova 2
                if (lengthScore < 20) {
                    suggestions.push(words < targetMin ? 'Aggiungi pi√π dettagli nella spiegazione' : 'Sii pi√π conciso, elimina parti non essenziali');
                }
                if (formalScore < 20) {
                    if (!hasFormalGreeting) suggestions.push('Inizia con "Gentile" o "Egregio" + titolo + cognome');
                    if (!usesFormalRegister) suggestions.push('Usa sempre il "Lei" formale, mai il "tu"');
                    if (!hasFormalClosing) suggestions.push('Termina con "Cordiali saluti" o "Distinti saluti"');
                }
                if (contentScore < 20) {
                    if (!hasApology) suggestions.push('Includi delle scuse appropriate per la situazione');
                    if (!hasRequest) suggestions.push('Fai una richiesta chiara e specifica');
                }
                if (subjectScore < 20) {
                    suggestions.push('Scrivi un oggetto chiaro che riassuma la richiesta');
                }
            }
            
            // Determine overall level
            let level = 'Insufficiente';
            let color = '#e74c3c';
            if (score >= 85) { level = 'Eccellente'; color = '#27ae60'; }
            else if (score >= 70) { level = 'Buono'; color = '#f39c12'; }
            else if (score >= 55) { level = 'Sufficiente'; color = '#3498db'; }
            
            if (suggestions.length === 0) {
                suggestions.push('Ottimo lavoro! Il testo rispetta tutti i criteri principali.');
            }
            
            return {
                score: score,
                level: level,
                color: color,
                criteria: criteria,
                suggestions: suggestions
            };
        }

        function showExampleSolution() {
            // This would show example solutions for each exercise
            alert('Funzione esempio in sviluppo! Presto vedrai soluzioni modello per ogni traccia.');
        }

        // Chiudi modal cliccando fuori
        window.onclick = function(event) {
            const modal = document.getElementById('exerciseModal');
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9875013de0c9f590',t:'MTc1OTI0ODc3OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>

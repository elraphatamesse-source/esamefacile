<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Produzione Scritta PREMIUM - CILS B2</title>
    <style>
        body {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }

        .premium-badge {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9em;
            z-index: 1000;
            box-shadow: 0 4px 15px rgba(240, 147, 251, 0.4);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .container {
            max-width: 1200px;
            margin: 10px auto 20px auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="75" cy="75" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="50" cy="10" r="0.5" fill="rgba(255,255,255,0.05)"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
            opacity: 0.3;
        }

        .header-content {
            position: relative;
            z-index: 1;
        }

        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .header .premium-subtitle {
            margin: 15px 0 0 0;
            opacity: 0.95;
            font-size: 1.2em;
            background: rgba(255,255,255,0.2);
            padding: 10px 20px;
            border-radius: 25px;
            display: inline-block;
            backdrop-filter: blur(10px);
        }

        .stats-dashboard {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 25px;
            margin: 0;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stat-card {
            background: rgba(255,255,255,0.2);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.3);
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .content {
            padding: 40px;
        }

        .premium-section {
            margin-bottom: 50px;
            padding: 30px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 20px;
            border: 2px solid transparent;
            background-clip: padding-box;
            position: relative;
            overflow: hidden;
        }

        .premium-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #764ba2, #f093fb, #f5576c);
            background-size: 400% 400%;
            animation: gradientShift 3s ease infinite;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .section-title {
            font-size: 1.6em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .ai-coach-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 20px;
            padding: 30px;
            margin: 30px 0;
            position: relative;
            overflow: hidden;
        }

        .ai-coach-section::before {
            content: '🤖';
            position: absolute;
            top: -20px;
            right: -20px;
            font-size: 8em;
            opacity: 0.1;
            transform: rotate(15deg);
        }

        .ai-feedback-box {
            background: rgba(255,255,255,0.15);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .progress-tracker {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .progress-bar {
            background: #e9ecef;
            border-radius: 10px;
            height: 20px;
            overflow: hidden;
            margin: 15px 0;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 10px;
            transition: width 0.8s ease;
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .skill-matrix {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .skill-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border-left: 5px solid #667eea;
        }

        .skill-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
        }

        .skill-level {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 15px 0;
        }

        .level-dots {
            display: flex;
            gap: 5px;
        }

        .dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #e9ecef;
            transition: background 0.3s ease;
        }

        .dot.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
        }

        .premium-exercise-card {
            background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);
            border: 2px solid transparent;
            border-radius: 20px;
            padding: 25px;
            margin: 20px 0;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .premium-exercise-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #667eea, #764ba2);
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 0;
        }

        .premium-exercise-card:hover::before {
            opacity: 0.05;
        }

        .premium-exercise-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(102, 126, 234, 0.2);
            border-color: #667eea;
        }

        .exercise-content {
            position: relative;
            z-index: 1;
        }

        .difficulty-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .difficulty-beginner { background: #d4edda; color: #155724; }
        .difficulty-intermediate { background: #fff3cd; color: #856404; }
        .difficulty-advanced { background: #f8d7da; color: #721c24; }

        .ai-writing-assistant {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .ai-writing-assistant:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 35px rgba(102, 126, 234, 0.6);
        }

        .ai-writing-assistant::before {
            content: '🤖';
            font-size: 1.5em;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }

        .modal {
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 25px;
            max-width: 800px;
            width: 90%;
            max-height: 85vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 25px 50px rgba(0,0,0,0.3);
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from { opacity: 0; transform: translateY(-50px) scale(0.9); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        .close {
            position: absolute;
            right: 20px;
            top: 20px;
            font-size: 32px;
            font-weight: bold;
            cursor: pointer;
            color: #aaa;
            transition: all 0.3s ease;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .close:hover {
            color: #e74c3c;
            background: rgba(231, 76, 60, 0.1);
        }

        .premium-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 10px;
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .premium-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s ease;
        }

        .premium-btn:hover::before {
            left: 100%;
        }

        .premium-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        .back-btn {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(44, 62, 80, 0.9);
            color: white;
            border: 2px solid rgba(255,255,255,0.3);
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 500;
            transition: all 0.3s ease;
            z-index: 1000;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            text-decoration: none;
            backdrop-filter: blur(10px);
        }

        .back-btn:hover {
            background: rgba(255,255,255,0.3);
            border-color: rgba(255,255,255,0.5);
            transform: scale(1.05);
        }

        .learning-path {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border-radius: 20px;
            padding: 30px;
            margin: 30px 0;
        }

        .path-steps {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }

        .path-step {
            background: rgba(255,255,255,0.2);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.3);
            transition: all 0.3s ease;
        }

        .path-step:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-5px);
        }

        .step-number {
            width: 40px;
            height: 40px;
            background: white;
            color: #f5576c;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin: 0 auto 15px auto;
        }

        .feature-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .feature-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #667eea, #764ba2);
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 0;
        }

        .feature-card:hover::before {
            opacity: 0.05;
        }

        .feature-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 40px rgba(102, 126, 234, 0.2);
            border-color: #667eea;
        }

        .feature-card > * {
            position: relative;
            z-index: 1;
        }

        .feature-icon {
            font-size: 3em;
            margin-bottom: 20px;
            display: block;
        }

        .feature-card h4 {
            color: #2c3e50;
            margin: 0 0 15px 0;
            font-size: 1.3em;
            font-weight: 600;
        }

        .feature-card p {
            color: #7f8c8d;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .feature-status {
            display: inline-block;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .feature-status:contains("Attivo") { background: #d4edda; color: #155724; }
        .feature-status:contains("Beta") { background: #fff3cd; color: #856404; }
        .feature-status:contains("Nuovo") { background: #f8d7da; color: #721c24; }
        .feature-status:contains("Completo") { background: #d1ecf1; color: #0c5460; }
        .feature-status:contains("Disponibile") { background: #e8f4fd; color: #2c3e50; }
        .feature-status:contains("Premium") { background: linear-gradient(135deg, #667eea, #764ba2); color: white; }

        .gamification-section {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border-radius: 20px;
            padding: 30px;
            margin: 30px 0;
            position: relative;
            overflow: hidden;
        }

        .gamification-section::before {
            content: '🏆';
            position: absolute;
            top: -30px;
            right: -30px;
            font-size: 10em;
            opacity: 0.1;
            transform: rotate(15deg);
        }

        .achievement-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }

        .achievement-card {
            background: rgba(255,255,255,0.2);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.3);
            transition: all 0.3s ease;
        }

        .achievement-card:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-5px);
        }

        .achievement-icon {
            font-size: 2.5em;
            margin-bottom: 15px;
            display: block;
        }

        .achievement-title {
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .achievement-progress {
            background: rgba(255,255,255,0.3);
            border-radius: 10px;
            height: 8px;
            overflow: hidden;
            margin: 10px 0;
        }

        .achievement-fill {
            height: 100%;
            background: white;
            border-radius: 10px;
            transition: width 0.8s ease;
        }

        @media (max-width: 768px) {
            body { padding: 10px; }
            .container { margin: 0 auto 80px auto; border-radius: 15px; }
            .header { padding: 20px 15px; }
            .header h1 { font-size: 1.8em; }
            .content { padding: 20px 15px; }
            .premium-section { padding: 20px 15px; margin-bottom: 30px; }
            .stats-grid { grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; }
            .skill-matrix { grid-template-columns: 1fr; gap: 15px; }
            .premium-badge { top: 10px; right: 10px; padding: 6px 12px; font-size: 0.8em; }
            .ai-writing-assistant { bottom: 20px; right: 20px; width: 50px; height: 50px; }
            .modal-content { padding: 20px; margin: 20px 10px; }
            .feature-card { padding: 20px; }
            .achievement-grid { grid-template-columns: 1fr; gap: 15px; }
        }
    </style>
</head>
<body>
    <div class="premium-badge">✨ PREMIUM</div>
    
    <div class="container">
        <div class="header">
            <div class="header-content">
                <h1>🎓 Produzione Scritta PREMIUM</h1>
                <div class="premium-subtitle">CILS B2 - Preparazione Avanzata con IA</div>
            </div>
        </div>

        <div class="stats-dashboard">
            <h3 style="margin: 0 0 10px 0; text-align: center;">📊 I Tuoi Progressi</h3>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalExercises">47</div>
                    <div class="stat-label">Esercizi Completati</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="averageScore">78</div>
                    <div class="stat-label">Punteggio Medio</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="studyStreak">12</div>
                    <div class="stat-label">Giorni Consecutivi</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="timeSpent">24h</div>
                    <div class="stat-label">Tempo di Studio</div>
                </div>
            </div>
        </div>

        <div class="content">
            <a href="cils.html" class="back-btn">← Versione Base</a>

            <!-- AI Coach Section -->
            <div class="ai-coach-section">
                <div class="section-title" style="color: white; margin-bottom: 20px;">
                    🤖 Coach IA Personalizzato
                </div>
                <div class="ai-feedback-box">
                    <h4 style="margin-top: 0; color: white;">💡 Analisi Intelligente dei Tuoi Testi</h4>
                    <p style="margin-bottom: 0; line-height: 1.6;">
                        Il nostro sistema IA analizza ogni tuo testo in tempo reale, identificando punti di forza e aree di miglioramento. 
                        Ricevi feedback personalizzato su grammatica, lessico, struttura e coerenza testuale.
                    </p>
                </div>
                <div class="ai-feedback-box">
                    <h4 style="margin-top: 0; color: white;">🎯 Suggerimenti Adattivi</h4>
                    <p style="margin-bottom: 0; line-height: 1.6;">
                        Basandosi sui tuoi errori ricorrenti, l'IA genera esercizi mirati e suggerisce strategie specifiche 
                        per superare le tue difficoltà individuali.
                    </p>
                </div>
                <button class="premium-btn" onclick="openAICoach()">Attiva Coach IA</button>
            </div>

            <!-- Learning Path -->
            <div class="learning-path">
                <div class="section-title" style="color: white; margin-bottom: 20px;">
                    🗺️ Percorso di Apprendimento Personalizzato
                </div>
                <p style="margin-bottom: 25px; line-height: 1.6;">
                    Un percorso studiato su misura per te, che si adatta al tuo livello e ai tuoi progressi.
                </p>
                <div class="path-steps">
                    <div class="path-step">
                        <div class="step-number">1</div>
                        <h4 style="margin: 0 0 10px 0;">Valutazione Iniziale</h4>
                        <p style="margin: 0; font-size: 0.9em;">Test diagnostico completo</p>
                    </div>
                    <div class="path-step">
                        <div class="step-number">2</div>
                        <h4 style="margin: 0 0 10px 0;">Piano Personalizzato</h4>
                        <p style="margin: 0; font-size: 0.9em;">Esercizi mirati alle tue lacune</p>
                    </div>
                    <div class="path-step">
                        <div class="step-number">3</div>
                        <h4 style="margin: 0 0 10px 0;">Pratica Intensiva</h4>
                        <p style="margin: 0; font-size: 0.9em;">200+ esercizi graduali</p>
                    </div>
                    <div class="path-step">
                        <div class="step-number">4</div>
                        <h4 style="margin: 0 0 10px 0;">Simulazioni Esame</h4>
                        <p style="margin: 0; font-size: 0.9em;">Prove in condizioni reali</p>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 25px;">
                    <button class="premium-btn" onclick="startLearningPath()">Inizia il Tuo Percorso</button>
                </div>
            </div>

            <!-- Progress Tracker -->
            <div class="premium-section">
                <div class="section-title">
                    📈 Monitoraggio Avanzato dei Progressi
                </div>
                
                <div class="progress-tracker">
                    <h4 style="margin-top: 0;">🎯 Competenze Chiave</h4>
                    <div class="skill-matrix">
                        <div class="skill-card">
                            <h5 style="margin-top: 0; color: #2c3e50;">Struttura Testuale</h5>
                            <div class="skill-level">
                                <span>Livello:</span>
                                <div class="level-dots">
                                    <div class="dot active"></div>
                                    <div class="dot active"></div>
                                    <div class="dot active"></div>
                                    <div class="dot active"></div>
                                    <div class="dot"></div>
                                </div>
                                <span style="font-weight: bold; color: #667eea;">4/5</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 80%;"></div>
                            </div>
                        </div>
                        
                        <div class="skill-card">
                            <h5 style="margin-top: 0; color: #2c3e50;">Lessico e Varietà</h5>
                            <div class="skill-level">
                                <span>Livello:</span>
                                <div class="level-dots">
                                    <div class="dot active"></div>
                                    <div class="dot active"></div>
                                    <div class="dot active"></div>
                                    <div class="dot"></div>
                                    <div class="dot"></div>
                                </div>
                                <span style="font-weight: bold; color: #f39c12;">3/5</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 60%;"></div>
                            </div>
                        </div>
                        
                        <div class="skill-card">
                            <h5 style="margin-top: 0; color: #2c3e50;">Correttezza Grammaticale</h5>
                            <div class="skill-level">
                                <span>Livello:</span>
                                <div class="level-dots">
                                    <div class="dot active"></div>
                                    <div class="dot active"></div>
                                    <div class="dot"></div>
                                    <div class="dot"></div>
                                    <div class="dot"></div>
                                </div>
                                <span style="font-weight: bold; color: #e74c3c;">2/5</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 40%;"></div>
                            </div>
                        </div>
                        
                        <div class="skill-card">
                            <h5 style="margin-top: 0; color: #2c3e50;">Registro Formale</h5>
                            <div class="skill-level">
                                <span>Livello:</span>
                                <div class="level-dots">
                                    <div class="dot active"></div>
                                    <div class="dot active"></div>
                                    <div class="dot active"></div>
                                    <div class="dot active"></div>
                                    <div class="dot active"></div>
                                </div>
                                <span style="font-weight: bold; color: #27ae60;">5/5</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 100%;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Premium Exercises -->
            <div class="premium-section">
                <div class="section-title">
                    🎯 Esercizi Premium con IA
                </div>
                
                <div class="premium-exercise-card" onclick="openPremiumExercise('adaptive')">
                    <div class="exercise-content">
                        <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 15px;">
                            <h3 style="margin: 0; color: #2c3e50;">🧠 Esercizi Adattivi con IA</h3>
                            <span class="difficulty-badge difficulty-advanced">Avanzato</span>
                        </div>
                        <p style="color: #7f8c8d; margin-bottom: 15px;">
                            Esercizi che si adattano in tempo reale al tuo livello. L'IA genera tracce personalizzate 
                            basate sui tuoi punti deboli e sui tuoi progressi.
                        </p>
                        <div style="display: flex; gap: 15px; align-items: center;">
                            <span style="background: #e8f4fd; color: #2c3e50; padding: 5px 10px; border-radius: 15px; font-size: 0.8em;">
                                🤖 Powered by AI
                            </span>
                            <span style="background: #f0f8ff; color: #2c3e50; padding: 5px 10px; border-radius: 15px; font-size: 0.8em;">
                                ∞ Tracce Infinite
                            </span>
                        </div>
                    </div>
                </div>

                <div class="premium-exercise-card" onclick="openPremiumExercise('realtime')">
                    <div class="exercise-content">
                        <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 15px;">
                            <h3 style="margin: 0; color: #2c3e50;">⚡ Correzione in Tempo Reale</h3>
                            <span class="difficulty-badge difficulty-intermediate">Intermedio</span>
                        </div>
                        <p style="color: #7f8c8d; margin-bottom: 15px;">
                            Scrivi e ricevi feedback istantaneo su grammatica, lessico e struttura. 
                            Suggerimenti intelligenti mentre componi il tuo testo.
                        </p>
                        <div style="display: flex; gap: 15px; align-items: center;">
                            <span style="background: #e8f5e8; color: #2c3e50; padding: 5px 10px; border-radius: 15px; font-size: 0.8em;">
                                ⚡ Feedback Istantaneo
                            </span>
                            <span style="background: #fff3cd; color: #2c3e50; padding: 5px 10px; border-radius: 15px; font-size: 0.8em;">
                                📝 Correzione Guidata
                            </span>
                        </div>
                    </div>
                </div>

                <div class="premium-exercise-card" onclick="openPremiumExercise('simulation')">
                    <div class="exercise-content">
                        <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 15px;">
                            <h3 style="margin: 0; color: #2c3e50;">🎭 Simulazioni Esame Realistiche</h3>
                            <span class="difficulty-badge difficulty-advanced">Avanzato</span>
                        </div>
                        <p style="color: #7f8c8d; margin-bottom: 15px;">
                            Prove complete in condizioni d'esame con cronometro, ambiente realistico e 
                            valutazione automatica secondo i criteri CILS ufficiali.
                        </p>
                        <div style="display: flex; gap: 15px; align-items: center;">
                            <span style="background: #f8d7da; color: #2c3e50; padding: 5px 10px; border-radius: 15px; font-size: 0.8em;">
                                ⏱️ Cronometro Reale
                            </span>
                            <span style="background: #d1ecf1; color: #2c3e50; padding: 5px 10px; border-radius: 15px; font-size: 0.8em;">
                                📊 Valutazione CILS
                            </span>
                        </div>
                    </div>
                </div>

                <div class="premium-exercise-card" onclick="openPremiumExercise('vocabulary')">
                    <div class="exercise-content">
                        <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 15px;">
                            <h3 style="margin: 0; color: #2c3e50;">📚 Espansione Lessicale Intelligente</h3>
                            <span class="difficulty-badge difficulty-beginner">Principiante</span>
                        </div>
                        <p style="color: #7f8c8d; margin-bottom: 15px;">
                            Sistema intelligente che identifica lacune lessicali e propone esercizi mirati 
                            per arricchire il tuo vocabolario specifico per il B2.
                        </p>
                        <div style="display: flex; gap: 15px; align-items: center;">
                            <span style="background: #e8f4fd; color: #2c3e50; padding: 5px 10px; border-radius: 15px; font-size: 0.8em;">
                                🎯 Lessico Mirato
                            </span>
                            <span style="background: #f0f8ff; color: #2c3e50; padding: 5px 10px; border-radius: 15px; font-size: 0.8em;">
                                📈 Progressi Tracciati
                            </span>
                        </div>
                    </div>
                </div>

                <div class="premium-exercise-card" onclick="openPremiumExercise('grammar')">
                    <div class="exercise-content">
                        <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 15px;">
                            <h3 style="margin: 0; color: #2c3e50;">📝 Grammatica Avanzata Interattiva</h3>
                            <span class="difficulty-badge difficulty-advanced">Avanzato</span>
                        </div>
                        <p style="color: #7f8c8d; margin-bottom: 15px;">
                            Esercizi interattivi su congiuntivo, condizionale, passivo e costruzioni complesse. 
                            Spiegazioni dettagliate e esempi contestualizzati.
                        </p>
                        <div style="display: flex; gap: 15px; align-items: center;">
                            <span style="background: #e8f5e8; color: #2c3e50; padding: 5px 10px; border-radius: 15px; font-size: 0.8em;">
                                📚 Teoria + Pratica
                            </span>
                            <span style="background: #f0f8ff; color: #2c3e50; padding: 5px 10px; border-radius: 15px; font-size: 0.8em;">
                                🎯 Errori Mirati
                            </span>
                        </div>
                    </div>
                </div>

                <div class="premium-exercise-card" onclick="openPremiumExercise('textTypes')">
                    <div class="exercise-content">
                        <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 15px;">
                            <h3 style="margin: 0; color: #2c3e50;">📄 Tipologie Testuali Complete</h3>
                            <span class="difficulty-badge difficulty-intermediate">Intermedio</span>
                        </div>
                        <p style="color: #7f8c8d; margin-bottom: 15px;">
                            Padroneggia tutte le tipologie: lettere formali, articoli, relazioni, recensioni, 
                            testi narrativi e argomentativi con esempi e modelli.
                        </p>
                        <div style="display: flex; gap: 15px; align-items: center;">
                            <span style="background: #fff3cd; color: #2c3e50; padding: 5px 10px; border-radius: 15px; font-size: 0.8em;">
                                📋 12 Tipologie
                            </span>
                            <span style="background: #d1ecf1; color: #2c3e50; padding: 5px 10px; border-radius: 15px; font-size: 0.8em;">
                                📖 Modelli Inclusi
                            </span>
                        </div>
                    </div>
                </div>

                <div class="premium-exercise-card" onclick="openPremiumExercise('peer')">
                    <div class="exercise-content">
                        <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 15px;">
                            <h3 style="margin: 0; color: #2c3e50;">👥 Correzione Collaborativa</h3>
                            <span class="difficulty-badge difficulty-intermediate">Intermedio</span>
                        </div>
                        <p style="color: #7f8c8d; margin-bottom: 15px;">
                            Correggi testi di altri studenti e ricevi feedback sui tuoi. Sistema di peer review 
                            guidato con criteri CILS per migliorare insieme.
                        </p>
                        <div style="display: flex; gap: 15px; align-items: center;">
                            <span style="background: #f8d7da; color: #2c3e50; padding: 5px 10px; border-radius: 15px; font-size: 0.8em;">
                                👥 Community
                            </span>
                            <span style="background: #e8f4fd; color: #2c3e50; padding: 5px 10px; border-radius: 15px; font-size: 0.8em;">
                                🏆 Punti Esperienza
                            </span>
                        </div>
                    </div>
                </div>

                <div class="premium-exercise-card" onclick="openPremiumExercise('cultural')">
                    <div class="exercise-content">
                        <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 15px;">
                            <h3 style="margin: 0; color: #2c3e50;">🇮🇹 Competenza Culturale</h3>
                            <span class="difficulty-badge difficulty-advanced">Avanzato</span>
                        </div>
                        <p style="color: #7f8c8d; margin-bottom: 15px;">
                            Esercizi su aspetti culturali italiani, modi di dire, registri linguistici e 
                            competenze socio-culturali essenziali per il B2.
                        </p>
                        <div style="display: flex; gap: 15px; align-items: center;">
                            <span style="background: #e8f5e8; color: #2c3e50; padding: 5px 10px; border-radius: 15px; font-size: 0.8em;">
                                🏛️ Cultura Italiana
                            </span>
                            <span style="background: #f0f8ff; color: #2c3e50; padding: 5px 10px; border-radius: 15px; font-size: 0.8em;">
                                💬 Registro Sociale
                            </span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Advanced Features Section -->
            <div class="premium-section">
                <div class="section-title">
                    🚀 Funzionalità Avanzate Premium
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px;">
                    <div class="feature-card" onclick="openFeature('mentor')">
                        <div class="feature-icon">🎓</div>
                        <h4>Mentore Virtuale 24/7</h4>
                        <p>Un tutor IA sempre disponibile per rispondere alle tue domande, spiegare regole grammaticali e fornire esempi personalizzati.</p>
                        <div class="feature-status">Attivo</div>
                    </div>
                    
                    <div class="feature-card" onclick="openFeature('voice')">
                        <div class="feature-icon">🎤</div>
                        <h4>Dettatura Vocale Intelligente</h4>
                        <p>Scrivi i tuoi testi usando la voce. Il sistema riconosce l'italiano e corregge automaticamente pronuncia e intonazione.</p>
                        <div class="feature-status">Beta</div>
                    </div>
                    
                    <div class="feature-card" onclick="openFeature('competition')">
                        <div class="feature-icon">🏆</div>
                        <h4>Sfide e Competizioni</h4>
                        <p>Partecipa a sfide settimanali con altri studenti, scala le classifiche e vinci badge esclusivi per i tuoi progressi.</p>
                        <div class="feature-status">Nuovo</div>
                    </div>
                    
                    <div class="feature-card" onclick="openFeature('library')">
                        <div class="feature-icon">📚</div>
                        <h4>Biblioteca Testi Modello</h4>
                        <p>Accesso a oltre 500 testi modello per ogni tipologia d'esame, con analisi dettagliate e spiegazioni punto per punto.</p>
                        <div class="feature-status">Completo</div>
                    </div>
                    
                    <div class="feature-card" onclick="openFeature('mobile')">
                        <div class="feature-icon">📱</div>
                        <h4>App Mobile Sincronizzata</h4>
                        <p>Studia ovunque con l'app mobile. Sincronizzazione automatica dei progressi e modalità offline per esercizi base.</p>
                        <div class="feature-status">Disponibile</div>
                    </div>
                    
                    <div class="feature-card" onclick="openFeature('certificate')">
                        <div class="feature-icon">🏅</div>
                        <h4>Certificazioni Intermedie</h4>
                        <p>Ottieni certificati digitali per ogni competenza padroneggiata. Perfetti per il CV e riconosciuti da istituzioni partner.</p>
                        <div class="feature-status">Premium</div>
                    </div>
                </div>
            </div>

            <!-- Analytics Section -->
            <div class="premium-section">
                <div class="section-title">
                    📊 Analytics Avanzati
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px;">
                    <div style="background: white; padding: 25px; border-radius: 15px; box-shadow: 0 8px 25px rgba(0,0,0,0.1);">
                        <h4 style="margin-top: 0; color: #2c3e50;">📈 Andamento Settimanale</h4>
                        <div style="background: #f8f9fa; height: 150px; border-radius: 10px; display: flex; align-items: center; justify-content: center; color: #7f8c8d;">
                            Grafico dei progressi settimanali
                        </div>
                        <p style="margin-bottom: 0; font-size: 0.9em; color: #7f8c8d; margin-top: 10px;">
                            Miglioramento costante del +15% questa settimana
                        </p>
                    </div>
                    
                    <div style="background: white; padding: 25px; border-radius: 15px; box-shadow: 0 8px 25px rgba(0,0,0,0.1);">
                        <h4 style="margin-top: 0; color: #2c3e50;">🎯 Errori Più Frequenti</h4>
                        <div style="margin: 15px 0;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <span>Accordo articoli</span>
                                <span style="color: #e74c3c; font-weight: bold;">23%</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <span>Congiuntivo</span>
                                <span style="color: #f39c12; font-weight: bold;">18%</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <span>Preposizioni</span>
                                <span style="color: #27ae60; font-weight: bold;">12%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Gamification Section -->
            <div class="gamification-section">
                <div class="section-title" style="color: white; margin-bottom: 20px;">
                    🏆 Sistema di Gamificazione
                </div>
                <p style="margin-bottom: 25px; line-height: 1.6;">
                    Trasforma il tuo apprendimento in un'avventura coinvolgente! Guadagna punti, sblocca achievement e scala le classifiche globali.
                </p>
                <div class="achievement-grid">
                    <div class="achievement-card">
                        <div class="achievement-icon">🔥</div>
                        <div class="achievement-title">Streak Master</div>
                        <div style="font-size: 0.9em; opacity: 0.9;">12/30 giorni consecutivi</div>
                        <div class="achievement-progress">
                            <div class="achievement-fill" style="width: 40%;"></div>
                        </div>
                    </div>
                    
                    <div class="achievement-card">
                        <div class="achievement-icon">📝</div>
                        <div class="achievement-title">Scrittore Prolifico</div>
                        <div style="font-size: 0.9em; opacity: 0.9;">47/100 testi completati</div>
                        <div class="achievement-progress">
                            <div class="achievement-fill" style="width: 47%;"></div>
                        </div>
                    </div>
                    
                    <div class="achievement-card">
                        <div class="achievement-icon">🎯</div>
                        <div class="achievement-title">Perfezionista</div>
                        <div style="font-size: 0.9em; opacity: 0.9;">5/10 testi con voto 90+</div>
                        <div class="achievement-progress">
                            <div class="achievement-fill" style="width: 50%;"></div>
                        </div>
                    </div>
                    
                    <div class="achievement-card">
                        <div class="achievement-icon">👑</div>
                        <div class="achievement-title">Grammatica Expert</div>
                        <div style="font-size: 0.9em; opacity: 0.9;">Padronanza congiuntivo</div>
                        <div class="achievement-progress">
                            <div class="achievement-fill" style="width: 75%;"></div>
                        </div>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 25px;">
                    <button class="premium-btn" onclick="openLeaderboard()">Visualizza Classifica Globale</button>
                </div>
            </div>

            <!-- Study Plan -->
            <div class="premium-section">
                <div class="section-title">
                    📅 Piano di Studio Personalizzato
                </div>
                
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 15px; padding: 25px; margin: 20px 0;">
                    <h4 style="margin-top: 0;">🎯 Obiettivo: Esame CILS B2 - 15 Marzo 2024</h4>
                    <div style="background: rgba(255,255,255,0.2); border-radius: 10px; padding: 20px; margin: 15px 0;">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                            <div>
                                <div style="font-size: 1.5em; font-weight: bold;">42</div>
                                <div style="font-size: 0.9em; opacity: 0.9;">Giorni rimanenti</div>
                            </div>
                            <div>
                                <div style="font-size: 1.5em; font-weight: bold;">3h/sett</div>
                                <div style="font-size: 0.9em; opacity: 0.9;">Studio consigliato</div>
                            </div>
                            <div>
                                <div style="font-size: 1.5em; font-weight: bold;">85%</div>
                                <div style="font-size: 0.9em; opacity: 0.9;">Probabilità successo</div>
                            </div>
                        </div>
                    </div>
                    <div style="text-align: center;">
                        <button class="premium-btn" onclick="openStudyPlan()">Visualizza Piano Completo</button>
                    </div>
                </div>
            </div>

            <!-- Subscription Plans -->
            <div class="premium-section">
                <div class="section-title">
                    💎 Piani di Abbonamento Premium
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px; margin: 25px 0;">
                    <div style="background: white; border-radius: 20px; padding: 30px; text-align: center; box-shadow: 0 8px 25px rgba(0,0,0,0.1); border: 2px solid #e9ecef;">
                        <div style="font-size: 2em; margin-bottom: 15px;">🥉</div>
                        <h4 style="color: #2c3e50; margin: 0 0 15px 0;">Premium Basic</h4>
                        <div style="font-size: 2.5em; font-weight: bold; color: #667eea; margin: 15px 0;">€19</div>
                        <div style="color: #7f8c8d; margin-bottom: 25px;">al mese</div>
                        <ul style="text-align: left; color: #7f8c8d; line-height: 1.8; padding-left: 20px;">
                            <li>✅ Esercizi adattivi illimitati</li>
                            <li>✅ Correzione in tempo reale</li>
                            <li>✅ Analytics base</li>
                            <li>✅ 50 testi modello</li>
                            <li>❌ Mentore IA 24/7</li>
                            <li>❌ Certificazioni</li>
                        </ul>
                        <button class="premium-btn" style="width: 100%; margin-top: 20px;" onclick="selectPlan('basic')">Scegli Basic</button>
                    </div>
                    
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 20px; padding: 30px; text-align: center; color: white; transform: scale(1.05); box-shadow: 0 15px 35px rgba(102, 126, 234, 0.3); position: relative;">
                        <div style="position: absolute; top: -10px; right: 20px; background: #f5576c; color: white; padding: 5px 15px; border-radius: 15px; font-size: 0.8em; font-weight: bold;">POPOLARE</div>
                        <div style="font-size: 2em; margin-bottom: 15px;">🥈</div>
                        <h4 style="margin: 0 0 15px 0;">Premium Pro</h4>
                        <div style="font-size: 2.5em; font-weight: bold; margin: 15px 0;">€39</div>
                        <div style="opacity: 0.9; margin-bottom: 25px;">al mese</div>
                        <ul style="text-align: left; line-height: 1.8; padding-left: 20px; opacity: 0.95;">
                            <li>✅ Tutto di Basic +</li>
                            <li>✅ Mentore IA 24/7</li>
                            <li>✅ Analytics avanzati</li>
                            <li>✅ 500+ testi modello</li>
                            <li>✅ Simulazioni esame</li>
                            <li>✅ App mobile premium</li>
                        </ul>
                        <button class="premium-btn" style="width: 100%; margin-top: 20px; background: white; color: #667eea;" onclick="selectPlan('pro')">Scegli Pro</button>
                    </div>
                    
                    <div style="background: white; border-radius: 20px; padding: 30px; text-align: center; box-shadow: 0 8px 25px rgba(0,0,0,0.1); border: 2px solid #f5576c;">
                        <div style="font-size: 2em; margin-bottom: 15px;">🥇</div>
                        <h4 style="color: #2c3e50; margin: 0 0 15px 0;">Premium Elite</h4>
                        <div style="font-size: 2.5em; font-weight: bold; color: #f5576c; margin: 15px 0;">€69</div>
                        <div style="color: #7f8c8d; margin-bottom: 25px;">al mese</div>
                        <ul style="text-align: left; color: #7f8c8d; line-height: 1.8; padding-left: 20px;">
                            <li>✅ Tutto di Pro +</li>
                            <li>✅ Tutor umano dedicato</li>
                            <li>✅ Sessioni 1-a-1 settimanali</li>
                            <li>✅ Certificazioni ufficiali</li>
                            <li>✅ Accesso prioritario</li>
                            <li>✅ Garanzia successo esame</li>
                        </ul>
                        <button class="premium-btn" style="width: 100%; margin-top: 20px; background: #f5576c;" onclick="selectPlan('elite')">Scegli Elite</button>
                    </div>
                </div>
                
                <div style="text-align: center; margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 15px;">
                    <h5 style="color: #2c3e50; margin: 0 0 10px 0;">🎁 Offerta Speciale di Lancio</h5>
                    <p style="color: #7f8c8d; margin: 0;">Primi 30 giorni GRATIS per tutti i piani! Nessun impegno, cancella quando vuoi.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- AI Writing Assistant -->
    <div class="ai-writing-assistant" onclick="openAIAssistant()" title="Assistente IA per la Scrittura"></div>

    <!-- Modals -->
    <div id="aiCoachModal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close" onclick="closeModal('aiCoachModal')">&times;</span>
            <div id="aiCoachContent">
                <h3>🤖 Coach IA Personalizzato</h3>
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 15px; padding: 25px; margin: 20px 0;">
                    <h4 style="margin-top: 0;">Analisi del Tuo Profilo</h4>
                    <div style="background: rgba(255,255,255,0.2); border-radius: 10px; padding: 15px; margin: 15px 0;">
                        <p style="margin: 0; line-height: 1.6;">
                            <strong>Punti di Forza:</strong> Eccellente uso del registro formale, buona strutturazione dei testi narrativi.<br><br>
                            <strong>Aree di Miglioramento:</strong> Varietà lessicale, uso del congiuntivo, accordo degli articoli.<br><br>
                            <strong>Raccomandazione:</strong> Concentrati su esercizi di grammatica avanzata e espansione del vocabolario.
                        </p>
                    </div>
                </div>
                <div style="text-align: center;">
                    <button class="premium-btn" onclick="startAISession()">Inizia Sessione IA</button>
                </div>
            </div>
        </div>
    </div>

    <div id="premiumExerciseModal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close" onclick="closeModal('premiumExerciseModal')">&times;</span>
            <div id="premiumExerciseContent"></div>
        </div>
    </div>

    <div id="writingExerciseModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 900px;">
            <span class="close" onclick="closeModal('writingExerciseModal')">&times;</span>
            <div id="writingExerciseContent"></div>
        </div>
    </div>

    <div id="examSimulationModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 1000px;">
            <span class="close" onclick="closeModal('examSimulationModal')">&times;</span>
            <div id="examSimulationContent"></div>
        </div>
    </div>

    <div id="vocabularyModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 800px;">
            <span class="close" onclick="closeModal('vocabularyModal')">&times;</span>
            <div id="vocabularyContent"></div>
        </div>
    </div>

    <script>
        // Simulate user data
        let userData = {
            totalExercises: 47,
            averageScore: 78,
            studyStreak: 12,
            timeSpent: 24,
            skills: {
                structure: 4,
                vocabulary: 3,
                grammar: 2,
                register: 5
            }
        };

        // Update stats on page load
        function updateStats() {
            document.getElementById('totalExercises').textContent = userData.totalExercises;
            document.getElementById('averageScore').textContent = userData.averageScore;
            document.getElementById('studyStreak').textContent = userData.studyStreak;
            document.getElementById('timeSpent').textContent = userData.timeSpent + 'h';
        }

        function openAICoach() {
            document.getElementById('aiCoachModal').style.display = 'flex';
        }

        function openAIAssistant() {
            alert('🤖 Assistente IA: "Ciao! Sono qui per aiutarti con la scrittura. Dimmi su cosa stai lavorando e ti darò suggerimenti personalizzati!"');
        }

        function startLearningPath() {
            alert('🗺️ Percorso di Apprendimento: Iniziando valutazione diagnostica personalizzata...');
        }

        function startAISession() {
            closeModal('aiCoachModal');
            alert('🤖 Sessione IA avviata! L\'intelligenza artificiale analizzerà i tuoi prossimi testi in tempo reale.');
        }

        function openStudyPlan() {
            alert('📅 Piano di Studio: Visualizzazione calendario personalizzato con obiettivi settimanali e promemoria automatici.');
        }

        function openPremiumExercise(type) {
            const modal = document.getElementById('premiumExerciseModal');
            const content = document.getElementById('premiumExerciseContent');
            
            let exerciseContent = '';
            
            switch(type) {
                case 'adaptive':
                    exerciseContent = `
                        <h3>🧠 Esercizi Adattivi con IA</h3>
                        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 15px; padding: 25px; margin: 20px 0;">
                            <h4 style="margin-top: 0;">🎯 Traccia Generata per Te</h4>
                            <div style="background: rgba(255,255,255,0.2); border-radius: 10px; padding: 15px; margin: 15px 0;">
                                <p style="margin: 0; line-height: 1.6;">
                                    <strong>Basandosi sui tuoi errori ricorrenti con gli articoli e il congiuntivo, l'IA ha generato questa traccia:</strong><br><br>
                                    "Scrivi una lettera formale al direttore della tua banca per lamentarti del servizio ricevuto. 
                                    Spiega dettagliatamente i problemi riscontrati e richiedi un incontro per discutere la situazione. 
                                    Usa almeno 3 forme del congiuntivo e fai attenzione agli accordi degli articoli."
                                </p>
                            </div>
                        </div>
                        <div style="text-align: center;">
                            <button class="premium-btn" onclick="startAdaptiveExercise()">Inizia Esercizio</button>
                        </div>
                    `;
                    break;
                case 'realtime':
                    exerciseContent = `
                        <h3>⚡ Correzione in Tempo Reale</h3>
                        <div style="background: #f8f9fa; border-radius: 15px; padding: 25px; margin: 20px 0;">
                            <h4 style="margin-top: 0;">✍️ Editor Intelligente</h4>
                            <textarea placeholder="Inizia a scrivere qui... L'IA ti darà suggerimenti in tempo reale!" 
                                      style="width: 100%; height: 200px; padding: 15px; border: 2px solid #667eea; border-radius: 10px; font-size: 1em; line-height: 1.6;"
                                      oninput="simulateRealTimeCorrection(this)"></textarea>
                            <div id="realTimeFeedback" style="background: #e8f4fd; border-radius: 10px; padding: 15px; margin-top: 15px; min-height: 50px;">
                                <strong>💡 Suggerimenti IA:</strong> Inizia a scrivere per ricevere feedback istantaneo...
                            </div>
                        </div>
                    `;
                    break;
                case 'simulation':
                    exerciseContent = `
                        <h3>🎭 Simulazione Esame Realistica</h3>
                        <div style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; border-radius: 15px; padding: 25px; margin: 20px 0;">
                            <h4 style="margin-top: 0;">⏱️ Condizioni d'Esame</h4>
                            <div style="background: rgba(255,255,255,0.2); border-radius: 10px; padding: 15px; margin: 15px 0;">
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                                    <div style="text-align: center;">
                                        <div style="font-size: 1.5em; font-weight: bold;">40 min</div>
                                        <div style="font-size: 0.9em;">Tempo totale</div>
                                    </div>
                                    <div style="text-align: center;">
                                        <div style="font-size: 1.5em; font-weight: bold;">2 Prove</div>
                                        <div style="font-size: 0.9em;">Narrativa + Formale</div>
                                    </div>
                                    <div style="text-align: center;">
                                        <div style="font-size: 1.5em; font-weight: bold;">CILS</div>
                                        <div style="font-size: 0.9em;">Criteri ufficiali</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div style="text-align: center;">
                            <button class="premium-btn" onclick="startExamSimulation()">Inizia Simulazione</button>
                        </div>
                    `;
                    break;
                case 'vocabulary':
                    exerciseContent = `
                        <h3>📚 Espansione Lessicale Intelligente</h3>
                        <div style="background: #f8f9fa; border-radius: 15px; padding: 25px; margin: 20px 0;">
                            <h4 style="margin-top: 0;">🎯 Lacune Identificate</h4>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 15px 0;">
                                <div style="background: white; padding: 15px; border-radius: 10px; border-left: 4px solid #e74c3c;">
                                    <strong>Emozioni e Sentimenti</strong><br>
                                    <small style="color: #7f8c8d;">Usa spesso "bello/brutto" - amplia il vocabolario</small>
                                </div>
                                <div style="background: white; padding: 15px; border-radius: 10px; border-left: 4px solid #f39c12;">
                                    <strong>Connettivi Avanzati</strong><br>
                                    <small style="color: #7f8c8d;">Limiti a "poi, dopo" - impara alternative</small>
                                </div>
                                <div style="background: white; padding: 15px; border-radius: 10px; border-left: 4px solid #27ae60;">
                                    <strong>Registro Formale</strong><br>
                                    <small style="color: #7f8c8d;">Ottimo! Continua così</small>
                                </div>
                            </div>
                        </div>
                        <div style="text-align: center;">
                            <button class="premium-btn" onclick="startVocabularyTraining()">Inizia Allenamento</button>
                        </div>
                    `;
                    break;
                case 'grammar':
                    exerciseContent = `
                        <h3>📝 Grammatica Avanzata Interattiva</h3>
                        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 15px; padding: 25px; margin: 20px 0;">
                            <h4 style="margin-top: 0;">🎯 Focus: Congiuntivo e Condizionale</h4>
                            <div style="background: rgba(255,255,255,0.2); border-radius: 10px; padding: 15px; margin: 15px 0;">
                                <p style="margin: 0; line-height: 1.6;">
                                    <strong>Esercizio Interattivo:</strong><br><br>
                                    Completa la frase con la forma corretta:<br>
                                    "Se io _____ (sapere) che avresti avuto problemi, ti _____ (aiutare) volentieri."<br><br>
                                    <em>Clicca sulle opzioni per scegliere:</em>
                                </p>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 15px 0;">
                                <button style="background: rgba(255,255,255,0.3); border: none; color: white; padding: 10px; border-radius: 8px; cursor: pointer;">avessi saputo</button>
                                <button style="background: rgba(255,255,255,0.3); border: none; color: white; padding: 10px; border-radius: 8px; cursor: pointer;">avrei aiutato</button>
                            </div>
                        </div>
                        <div style="text-align: center;">
                            <button class="premium-btn" onclick="startGrammarTraining()">Continua Esercizi</button>
                        </div>
                    `;
                    break;
                case 'textTypes':
                    exerciseContent = `
                        <h3>📄 Tipologie Testuali Complete</h3>
                        <div style="background: #f8f9fa; border-radius: 15px; padding: 25px; margin: 20px 0;">
                            <h4 style="margin-top: 0;">📋 Tutte le Tipologie CILS B2</h4>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin: 15px 0;">
                                <div style="background: white; padding: 15px; border-radius: 10px; cursor: pointer; transition: all 0.3s ease;" onclick="alert('📧 Lettera Formale: Modelli e esempi per reclami, richieste, candidature...')">
                                    <strong>📧 Lettera Formale</strong><br>
                                    <small style="color: #7f8c8d;">Reclami, richieste, candidature</small>
                                </div>
                                <div style="background: white; padding: 15px; border-radius: 10px; cursor: pointer; transition: all 0.3s ease;" onclick="alert('📰 Articolo Giornalistico: Tecniche di scrittura, struttura, registro...')">
                                    <strong>📰 Articolo Giornalistico</strong><br>
                                    <small style="color: #7f8c8d;">Cronaca, opinioni, interviste</small>
                                </div>
                                <div style="background: white; padding: 15px; border-radius: 10px; cursor: pointer; transition: all 0.3s ease;" onclick="alert('📊 Relazione Tecnica: Struttura, linguaggio specialistico, grafici...')">
                                    <strong>📊 Relazione Tecnica</strong><br>
                                    <small style="color: #7f8c8d;">Rapporti, analisi, proposte</small>
                                </div>
                                <div style="background: white; padding: 15px; border-radius: 10px; cursor: pointer; transition: all 0.3s ease;" onclick="alert('⭐ Recensione: Criteri di valutazione, linguaggio critico, struttura...')">
                                    <strong>⭐ Recensione</strong><br>
                                    <small style="color: #7f8c8d;">Libri, film, ristoranti</small>
                                </div>
                                <div style="background: white; padding: 15px; border-radius: 10px; cursor: pointer; transition: all 0.3s ease;" onclick="alert('📖 Testo Narrativo: Tecniche narrative, descrizioni, dialoghi...')">
                                    <strong>📖 Testo Narrativo</strong><br>
                                    <small style="color: #7f8c8d;">Racconti, memorie, diari</small>
                                </div>
                                <div style="background: white; padding: 15px; border-radius: 10px; cursor: pointer; transition: all 0.3s ease;" onclick="alert('💭 Testo Argomentativo: Tesi, antitesi, sintesi, esempi...')">
                                    <strong>💭 Testo Argomentativo</strong><br>
                                    <small style="color: #7f8c8d;">Saggi, dibattiti, opinioni</small>
                                </div>
                            </div>
                        </div>
                        <div style="text-align: center;">
                            <button class="premium-btn" onclick="startTextTypeTraining()">Esplora Tutte le Tipologie</button>
                        </div>
                    `;
                    break;
                case 'peer':
                    exerciseContent = `
                        <h3>👥 Correzione Collaborativa</h3>
                        <div style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; border-radius: 15px; padding: 25px; margin: 20px 0;">
                            <h4 style="margin-top: 0;">🤝 Community di Apprendimento</h4>
                            <div style="background: rgba(255,255,255,0.2); border-radius: 10px; padding: 15px; margin: 15px 0;">
                                <p style="margin: 0; line-height: 1.6;">
                                    <strong>Testo da Correggere (Anonimo):</strong><br><br>
                                    "Gentile Direttore, scrivo questa lettera per lamentarmi del servizio che ho ricevuto nella vostra banca. 
                                    Ieri sono andato per aprire un conto corrente ma l'impiegato è stato molto scortese con me..."<br><br>
                                    <em>Identifica errori e suggerisci miglioramenti:</em>
                                </p>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 15px 0;">
                                <div style="background: rgba(255,255,255,0.3); padding: 10px; border-radius: 8px; text-align: center;">
                                    <strong>+15 XP</strong><br>
                                    <small>Per ogni correzione</small>
                                </div>
                                <div style="background: rgba(255,255,255,0.3); padding: 10px; border-radius: 8px; text-align: center;">
                                    <strong>🏆 Badge</strong><br>
                                    <small>Correttore Esperto</small>
                                </div>
                            </div>
                        </div>
                        <div style="text-align: center;">
                            <button class="premium-btn" onclick="startPeerReview()">Inizia Correzione</button>
                        </div>
                    `;
                    break;
                case 'cultural':
                    exerciseContent = `
                        <h3>🇮🇹 Competenza Culturale</h3>
                        <div style="background: #f8f9fa; border-radius: 15px; padding: 25px; margin: 20px 0;">
                            <h4 style="margin-top: 0;">🏛️ Cultura e Società Italiana</h4>
                            <div style="background: white; padding: 20px; border-radius: 10px; margin: 15px 0; border-left: 4px solid #27ae60;">
                                <p style="margin: 0; line-height: 1.6;">
                                    <strong>Scenario Culturale:</strong><br><br>
                                    Stai scrivendo una lettera formale a un'azienda italiana. Quale saluto è più appropriato 
                                    per il contesto business italiano?<br><br>
                                    A) "Ciao, come va?"<br>
                                    B) "Egregio Signore/Signora"<br>
                                    C) "Salve, spero che tutto vada bene"<br><br>
                                    <em>Considera le convenzioni sociali italiane...</em>
                                </p>
                            </div>
                            <div style="background: #e8f4fd; padding: 15px; border-radius: 10px; margin: 15px 0;">
                                <strong>💡 Curiosità Culturale:</strong><br>
                                In Italia, il registro formale è molto importante nelle comunicazioni business. 
                                L'uso del "Lei" e formule di cortesia specifiche sono essenziali per il successo professionale.
                            </div>
                        </div>
                        <div style="text-align: center;">
                            <button class="premium-btn" onclick="startCulturalTraining()">Esplora Cultura Italiana</button>
                        </div>
                    `;
                    break;
            }
            
            content.innerHTML = exerciseContent;
            modal.style.display = 'flex';
        }

        function simulateRealTimeCorrection(textarea) {
            const text = textarea.value;
            const feedback = document.getElementById('realTimeFeedback');
            
            if (text.length < 10) {
                feedback.innerHTML = '<strong>💡 Suggerimenti IA:</strong> Inizia a scrivere per ricevere feedback istantaneo...';
                return;
            }
            
            let suggestions = [];
            
            if (text.toLowerCase().includes('gentile dottore')) {
                suggestions.push('✅ Ottimo saluto formale!');
            }
            
            if (text.includes(' tu ')) {
                suggestions.push('⚠️ Usa "Lei" invece di "tu" nel registro formale');
            }
            
            if (text.toLowerCase().includes('un problema')) {
                suggestions.push('💡 Considera sinonimi: "una difficoltà", "un inconveniente", "una questione"');
            }
            
            if (suggestions.length === 0) {
                suggestions.push('👍 Il testo sembra ben strutturato finora!');
            }
            
            feedback.innerHTML = '<strong>💡 Suggerimenti IA:</strong><br>' + suggestions.join('<br>');
        }

        function startAdaptiveExercise() {
            closeModal('premiumExerciseModal');
            openWritingExercise('adaptive');
        }

        function startExamSimulation() {
            closeModal('premiumExerciseModal');
            openExamSimulation();
        }

        function startVocabularyTraining() {
            closeModal('premiumExerciseModal');
            openVocabularyExercise();
        }

        function openWritingExercise(type) {
            const modal = document.getElementById('writingExerciseModal');
            const content = document.getElementById('writingExerciseContent');
            
            const exercises = {
                adaptive: {
                    title: "🧠 Esercizio Adattivo - Lettera di Reclamo",
                    prompt: "Scrivi una lettera formale al direttore di un hotel per lamentarti del servizio ricevuto durante il tuo soggiorno. Descrivi i problemi specifici e richiedi un rimborso parziale. (200-250 parole)",
                    tips: ["Usa il registro formale", "Includi almeno 2 forme del congiuntivo", "Struttura: saluto, esposizione problema, richiesta, chiusura"],
                    timeLimit: 25
                }
            };
            
            const exercise = exercises[type];
            content.innerHTML = `
                <h3>${exercise.title}</h3>
                <div style="background: #f8f9fa; border-radius: 15px; padding: 20px; margin: 20px 0;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h4 style="margin: 0;">📝 Traccia</h4>
                        <div id="timer" style="background: #667eea; color: white; padding: 8px 15px; border-radius: 20px; font-weight: bold;">
                            ⏱️ ${exercise.timeLimit}:00
                        </div>
                    </div>
                    <p style="line-height: 1.6; margin-bottom: 20px;">${exercise.prompt}</p>
                    
                    <div style="background: #e8f4fd; border-radius: 10px; padding: 15px; margin-bottom: 20px;">
                        <strong>💡 Suggerimenti:</strong>
                        <ul style="margin: 10px 0; padding-left: 20px;">
                            ${exercise.tips.map(tip => `<li>${tip}</li>`).join('')}
                        </ul>
                    </div>
                    
                    <textarea id="writingArea" placeholder="Inizia a scrivere qui..." 
                              style="width: 100%; height: 300px; padding: 15px; border: 2px solid #667eea; border-radius: 10px; font-size: 1em; line-height: 1.6; resize: vertical;"
                              oninput="analyzeWriting()"></textarea>
                    
                    <div id="writingStats" style="display: flex; justify-content: space-between; margin: 15px 0; font-size: 0.9em; color: #7f8c8d;">
                        <span>Parole: <strong id="wordCount">0</strong></span>
                        <span>Caratteri: <strong id="charCount">0</strong></span>
                        <span>Tempo rimanente: <strong id="timeLeft">${exercise.timeLimit}:00</strong></span>
                    </div>
                    
                    <div id="liveAnalysis" style="background: white; border-radius: 10px; padding: 15px; margin: 15px 0; border-left: 4px solid #667eea;">
                        <strong>🤖 Analisi in Tempo Reale:</strong>
                        <div id="analysisContent">Inizia a scrivere per ricevere feedback istantaneo...</div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="premium-btn" onclick="submitWriting()" style="margin-right: 10px;">Invia per Valutazione</button>
                        <button class="premium-btn" onclick="saveAsDraft()" style="background: #6c757d;">Salva Bozza</button>
                    </div>
                </div>
            `;
            
            modal.style.display = 'flex';
            startTimer(exercise.timeLimit);
        }

        function openExamSimulation() {
            const modal = document.getElementById('examSimulationModal');
            const content = document.getElementById('examSimulationContent');
            
            content.innerHTML = `
                <h3>🎭 Simulazione Esame CILS B2 - Produzione Scritta</h3>
                <div style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; border-radius: 15px; padding: 25px; margin: 20px 0;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h4 style="margin: 0;">⏱️ Tempo Totale: 40 minuti</h4>
                        <div id="examTimer" style="background: rgba(255,255,255,0.3); padding: 10px 20px; border-radius: 20px; font-size: 1.2em; font-weight: bold;">
                            40:00
                        </div>
                    </div>
                    <div style="background: rgba(255,255,255,0.2); border-radius: 10px; padding: 15px;">
                        <p style="margin: 0; line-height: 1.6;">
                            <strong>Istruzioni:</strong> Completa entrambe le prove nel tempo stabilito. 
                            Ogni prova vale 50 punti. Punteggio minimo per superare: 60/100.
                        </p>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                    <div style="background: #f8f9fa; border-radius: 15px; padding: 20px;">
                        <h4 style="margin-top: 0; color: #2c3e50;">📝 Prova 1 - Testo Narrativo</h4>
                        <p style="font-size: 0.9em; line-height: 1.6; margin-bottom: 15px;">
                            Racconta un episodio significativo della tua vita che ti ha fatto cambiare opinione su qualcosa. 
                            Descrivi la situazione, le tue emozioni e le conseguenze. (150-180 parole)
                        </p>
                        <textarea id="examText1" placeholder="Scrivi qui la Prova 1..." 
                                  style="width: 100%; height: 200px; padding: 10px; border: 2px solid #667eea; border-radius: 8px; font-size: 0.9em;"
                                  oninput="updateExamStats(1)"></textarea>
                        <div style="font-size: 0.8em; color: #7f8c8d; margin-top: 10px;">
                            Parole: <strong id="examWords1">0</strong> / 150-180
                        </div>
                    </div>
                    
                    <div style="background: #f8f9fa; border-radius: 15px; padding: 20px;">
                        <h4 style="margin-top: 0; color: #2c3e50;">📧 Prova 2 - Lettera Formale</h4>
                        <p style="font-size: 0.9em; line-height: 1.6; margin-bottom: 15px;">
                            Scrivi al sindaco della tua città per proporre un progetto di miglioramento urbano. 
                            Spiega il problema, la tua proposta e i benefici per la comunità. (150-180 parole)
                        </p>
                        <textarea id="examText2" placeholder="Scrivi qui la Prova 2..." 
                                  style="width: 100%; height: 200px; padding: 10px; border: 2px solid #667eea; border-radius: 8px; font-size: 0.9em;"
                                  oninput="updateExamStats(2)"></textarea>
                        <div style="font-size: 0.8em; color: #7f8c8d; margin-top: 10px;">
                            Parole: <strong id="examWords2">0</strong> / 150-180
                        </div>
                    </div>
                </div>
                
                <div id="examProgress" style="background: white; border-radius: 10px; padding: 20px; margin: 20px 0;">
                    <h5 style="margin-top: 0;">📊 Progresso Esame</h5>
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; text-align: center;">
                        <div>
                            <div style="font-size: 1.5em; color: #667eea;" id="totalWords">0</div>
                            <div style="font-size: 0.8em; color: #7f8c8d;">Parole Totali</div>
                        </div>
                        <div>
                            <div style="font-size: 1.5em; color: #f39c12;" id="completionRate">0%</div>
                            <div style="font-size: 0.8em; color: #7f8c8d;">Completamento</div>
                        </div>
                        <div>
                            <div style="font-size: 1.5em; color: #e74c3c;" id="timeRemaining">40:00</div>
                            <div style="font-size: 0.8em; color: #7f8c8d;">Tempo Rimanente</div>
                        </div>
                    </div>
                </div>
                
                <div style="text-align: center; margin-top: 25px;">
                    <button class="premium-btn" onclick="submitExam()" style="margin-right: 15px;">🎯 Consegna Esame</button>
                    <button class="premium-btn" onclick="pauseExam()" style="background: #f39c12;">⏸️ Pausa</button>
                </div>
            `;
            
            modal.style.display = 'flex';
            startExamTimer(40);
        }

        function openVocabularyExercise() {
            const modal = document.getElementById('vocabularyModal');
            const content = document.getElementById('vocabularyContent');
            
            const vocabularyExercises = [
                {
                    word: "meraviglioso",
                    alternatives: ["stupendo", "magnifico", "straordinario", "eccezionale"],
                    context: "Il panorama era _____ dalla cima della montagna.",
                    explanation: "Evita di usare sempre 'bello'. Queste alternative sono più specifiche e ricche."
                },
                {
                    word: "poi",
                    alternatives: ["successivamente", "in seguito", "dopodiché", "inoltre"],
                    context: "Ho finito il lavoro e _____ sono andato a casa.",
                    explanation: "I connettivi temporali rendono il testo più fluido e professionale."
                },
                {
                    word: "molto",
                    alternatives: ["estremamente", "particolarmente", "notevolmente", "decisamente"],
                    context: "Sono _____ soddisfatto del risultato ottenuto.",
                    explanation: "Intensificatori più precisi migliorano l'espressività del testo."
                }
            ];
            
            let currentExercise = 0;
            let score = 0;
            
            function showVocabularyExercise() {
                const exercise = vocabularyExercises[currentExercise];
                content.innerHTML = `
                    <h3>📚 Espansione Lessicale - Esercizio ${currentExercise + 1}/3</h3>
                    <div style="background: #f8f9fa; border-radius: 15px; padding: 25px; margin: 20px 0;">
                        <div style="text-align: center; margin-bottom: 20px;">
                            <div style="background: #667eea; color: white; padding: 10px 20px; border-radius: 20px; display: inline-block;">
                                Punteggio: ${score}/3 ⭐
                            </div>
                        </div>
                        
                        <div style="background: white; border-radius: 10px; padding: 20px; margin: 20px 0; border-left: 4px solid #e74c3c;">
                            <h4 style="margin-top: 0; color: #e74c3c;">❌ Parola da Evitare</h4>
                            <p style="font-size: 1.2em; font-weight: bold; color: #2c3e50;">"${exercise.word}"</p>
                        </div>
                        
                        <div style="background: white; border-radius: 10px; padding: 20px; margin: 20px 0; border-left: 4px solid #27ae60;">
                            <h4 style="margin-top: 0; color: #27ae60;">✅ Alternative Migliori</h4>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin: 15px 0;">
                                ${exercise.alternatives.map(alt => `
                                    <div style="background: #e8f5e8; padding: 10px; border-radius: 8px; text-align: center; font-weight: bold; color: #27ae60;">
                                        ${alt}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div style="background: #e8f4fd; border-radius: 10px; padding: 20px; margin: 20px 0;">
                            <h4 style="margin-top: 0; color: #2c3e50;">🎯 Esercizio Pratico</h4>
                            <p style="line-height: 1.6; margin-bottom: 15px;">
                                Completa la frase scegliendo l'alternativa più appropriata:
                            </p>
                            <p style="font-size: 1.1em; font-style: italic; margin: 15px 0; padding: 15px; background: white; border-radius: 8px;">
                                "${exercise.context}"
                            </p>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin: 20px 0;">
                                ${exercise.alternatives.map((alt, index) => `
                                    <button onclick="selectVocabularyAnswer('${alt}', ${index})" 
                                            style="background: white; border: 2px solid #667eea; color: #667eea; padding: 12px; border-radius: 8px; cursor: pointer; font-weight: bold; transition: all 0.3s ease;"
                                            onmouseover="this.style.background='#667eea'; this.style.color='white';"
                                            onmouseout="this.style.background='white'; this.style.color='#667eea';">
                                        ${alt}
                                    </button>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div style="background: #fff3cd; border-radius: 10px; padding: 15px; margin: 20px 0;">
                            <strong>💡 Spiegazione:</strong> ${exercise.explanation}
                        </div>
                    </div>
                `;
            }
            
            window.selectVocabularyAnswer = function(answer, index) {
                score++;
                currentExercise++;
                
                if (currentExercise < vocabularyExercises.length) {
                    setTimeout(() => {
                        showVocabularyExercise();
                    }, 1000);
                    
                    // Show temporary feedback
                    content.innerHTML += `
                        <div style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #27ae60; color: white; padding: 20px 40px; border-radius: 15px; font-size: 1.2em; font-weight: bold; z-index: 3000;">
                            ✅ Ottima scelta! +1 punto
                        </div>
                    `;
                    
                    setTimeout(() => {
                        const feedback = document.querySelector('[style*="position: fixed"]');
                        if (feedback) feedback.remove();
                    }, 1000);
                } else {
                    // Show final results
                    content.innerHTML = `
                        <h3>🎉 Esercizio Completato!</h3>
                        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 15px; padding: 30px; margin: 20px 0; text-align: center;">
                            <div style="font-size: 3em; margin-bottom: 15px;">🏆</div>
                            <h4 style="margin: 0 0 15px 0;">Punteggio Finale</h4>
                            <div style="font-size: 2.5em; font-weight: bold; margin: 15px 0;">${score}/3</div>
                            <div style="font-size: 1.1em; opacity: 0.9;">
                                ${score === 3 ? 'Perfetto! Hai padroneggiato queste alternative lessicali!' : 
                                  score === 2 ? 'Molto bene! Continua a praticare per migliorare.' :
                                  'Buon inizio! Ripeti l\'esercizio per consolidare.'}
                            </div>
                        </div>
                        
                        <div style="background: #f8f9fa; border-radius: 15px; padding: 20px; margin: 20px 0;">
                            <h4 style="margin-top: 0;">📈 I Tuoi Progressi</h4>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                                <div style="text-align: center;">
                                    <div style="font-size: 1.5em; color: #667eea;">+${score * 10}</div>
                                    <div style="font-size: 0.9em; color: #7f8c8d;">Punti XP</div>
                                </div>
                                <div style="text-align: center;">
                                    <div style="font-size: 1.5em; color: #27ae60;">+${score * 3}</div>
                                    <div style="font-size: 0.9em; color: #7f8c8d;">Parole Apprese</div>
                                </div>
                                <div style="text-align: center;">
                                    <div style="font-size: 1.5em; color: #f39c12;">${Math.round(score/3*100)}%</div>
                                    <div style="font-size: 0.9em; color: #7f8c8d;">Accuratezza</div>
                                </div>
                            </div>
                        </div>
                        
                        <div style="text-align: center; margin-top: 25px;">
                            <button class="premium-btn" onclick="restartVocabularyExercise()" style="margin-right: 15px;">🔄 Ripeti Esercizio</button>
                            <button class="premium-btn" onclick="closeModal('vocabularyModal')" style="background: #27ae60;">✅ Continua</button>
                        </div>
                    `;
                }
            };
            
            window.restartVocabularyExercise = function() {
                currentExercise = 0;
                score = 0;
                showVocabularyExercise();
            };
            
            showVocabularyExercise();
            modal.style.display = 'flex';
        }

        function openFeature(featureType) {
            let message = '';
            switch(featureType) {
                case 'mentor':
                    message = '🎓 Mentore Virtuale: "Ciao! Sono il tuo tutor IA personale. Posso spiegarti qualsiasi regola grammaticale, aiutarti con la struttura dei testi e rispondere a tutte le tue domande 24/7!"';
                    break;
                case 'voice':
                    message = '🎤 Dettatura Vocale: Funzionalità in Beta! Presto potrai scrivere i tuoi testi semplicemente parlando. Il sistema riconoscerà l\'italiano e correggerà automaticamente.';
                    break;
                case 'competition':
                    message = '🏆 Sfide Settimanali: Partecipa alla "Sfida della Settimana" - Scrivi un testo su un tema specifico e competi con studenti di tutto il mondo!';
                    break;
                case 'library':
                    message = '📚 Biblioteca Testi: Accesso completo a 500+ testi modello per ogni tipologia CILS B2, con analisi dettagliate e spiegazioni punto per punto.';
                    break;
                case 'mobile':
                    message = '📱 App Mobile: Scarica l\'app per iOS e Android! Studia ovunque, anche offline. Sincronizzazione automatica con la versione web.';
                    break;
                case 'certificate':
                    message = '🏅 Certificazioni: Ottieni certificati digitali verificabili per ogni competenza padroneggiata. Riconosciuti da università e aziende partner.';
                    break;
            }
            alert(message);
        }

        function openLeaderboard() {
            alert('🏆 Classifica Globale:\n\n1. 👑 Marco_B2 - 2,847 punti\n2. 🥈 Sofia_Milano - 2,634 punti\n3. 🥉 Alex_Student - 2,401 punti\n...\n47. 🔥 Tu - 1,892 punti\n\nContinua così! Sei nella top 50 mondiale!');
        }

        function selectPlan(planType) {
            let planName = '';
            let price = '';
            switch(planType) {
                case 'basic':
                    planName = 'Premium Basic';
                    price = '€19/mese';
                    break;
                case 'pro':
                    planName = 'Premium Pro';
                    price = '€39/mese';
                    break;
                case 'elite':
                    planName = 'Premium Elite';
                    price = '€69/mese';
                    break;
            }
            alert(`💎 Hai scelto ${planName} (${price})\n\n🎁 OFFERTA SPECIALE: Primi 30 giorni GRATIS!\n\nFunzionalità incluse:\n✅ Accesso immediato a tutte le funzioni\n✅ Nessun impegno - cancella quando vuoi\n✅ Supporto clienti prioritario\n\nProcedi con il pagamento per attivare il tuo piano premium!`);
        }

        function startGrammarTraining() {
            alert('📝 Grammatica Avanzata: Perfetto! Hai scelto "avessi saputo" e "avrei aiutato" - Risposta corretta! Continuiamo con il periodo ipotetico...');
        }

        function startTextTypeTraining() {
            alert('📄 Tipologie Testuali: Accesso completo a 12 tipologie testuali con 500+ esempi, modelli e spiegazioni dettagliate per ogni tipo di testo CILS B2.');
        }

        function startPeerReview() {
            alert('👥 Correzione Collaborativa: Ottimo! Hai identificato 3 errori nel testo. +45 XP guadagnati! Il tuo feedback aiuterà altri studenti a migliorare.');
        }

        function startCulturalTraining() {
            alert('🇮🇹 Competenza Culturale: Risposta corretta! "Egregio Signore/Signora" è la formula più appropriata nel business italiano. Continuiamo con i registri linguistici...');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        }

        // Timer functions
        let timerInterval;
        let examTimerInterval;
        
        function startTimer(minutes) {
            let timeLeft = minutes * 60;
            const timerElement = document.getElementById('timer');
            const timeLeftElement = document.getElementById('timeLeft');
            
            timerInterval = setInterval(() => {
                const mins = Math.floor(timeLeft / 60);
                const secs = timeLeft % 60;
                const timeString = `${mins}:${secs.toString().padStart(2, '0')}`;
                
                if (timerElement) timerElement.textContent = `⏱️ ${timeString}`;
                if (timeLeftElement) timeLeftElement.textContent = timeString;
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    alert('⏰ Tempo scaduto! Il tuo testo è stato salvato automaticamente.');
                }
                timeLeft--;
            }, 1000);
        }
        
        function startExamTimer(minutes) {
            let timeLeft = minutes * 60;
            const examTimerElement = document.getElementById('examTimer');
            const timeRemainingElement = document.getElementById('timeRemaining');
            
            examTimerInterval = setInterval(() => {
                const mins = Math.floor(timeLeft / 60);
                const secs = timeLeft % 60;
                const timeString = `${mins}:${secs.toString().padStart(2, '0')}`;
                
                if (examTimerElement) examTimerElement.textContent = timeString;
                if (timeRemainingElement) timeRemainingElement.textContent = timeString;
                
                if (timeLeft <= 300 && timeLeft > 0) { // Last 5 minutes
                    if (examTimerElement) examTimerElement.style.background = 'rgba(231, 76, 60, 0.8)';
                }
                
                if (timeLeft <= 0) {
                    clearInterval(examTimerInterval);
                    submitExam();
                }
                timeLeft--;
            }, 1000);
        }
        
        function analyzeWriting() {
            const text = document.getElementById('writingArea').value;
            const wordCount = text.trim().split(/\s+/).filter(word => word.length > 0).length;
            const charCount = text.length;
            
            document.getElementById('wordCount').textContent = wordCount;
            document.getElementById('charCount').textContent = charCount;
            
            // Real-time analysis
            const analysisContent = document.getElementById('analysisContent');
            let feedback = [];
            
            if (wordCount < 50) {
                feedback.push('📝 Continua a scrivere per raggiungere la lunghezza richiesta');
            } else if (wordCount >= 200 && wordCount <= 250) {
                feedback.push('✅ Lunghezza perfetta per la traccia!');
            } else if (wordCount > 250) {
                feedback.push('⚠️ Attenzione: stai superando il limite di parole consigliato');
            }
            
            // Check for formal register
            if (text.toLowerCase().includes('egregio') || text.toLowerCase().includes('gentile')) {
                feedback.push('✅ Ottimo uso del registro formale');
            }
            
            // Check for subjunctive
            const subjunctivePatterns = ['che io sia', 'che tu sia', 'che lei sia', 'penso che', 'credo che', 'spero che'];
            const hasSubjunctive = subjunctivePatterns.some(pattern => text.toLowerCase().includes(pattern));
            if (hasSubjunctive) {
                feedback.push('✅ Rilevato uso del congiuntivo - ottimo!');
            } else if (wordCount > 100) {
                feedback.push('💡 Prova ad includere forme del congiuntivo');
            }
            
            // Check for variety
            const commonWords = ['molto', 'bello', 'buono', 'poi'];
            const overusedWords = commonWords.filter(word => 
                (text.toLowerCase().match(new RegExp(word, 'g')) || []).length > 2
            );
            if (overusedWords.length > 0) {
                feedback.push(`💡 Parole ripetute: ${overusedWords.join(', ')} - prova sinonimi`);
            }
            
            if (feedback.length === 0) {
                feedback.push('👍 Il testo sta prendendo forma bene!');
            }
            
            analysisContent.innerHTML = feedback.join('<br>');
        }
        
        function updateExamStats(examNumber) {
            const text1 = document.getElementById('examText1').value;
            const text2 = document.getElementById('examText2').value;
            
            const words1 = text1.trim().split(/\s+/).filter(word => word.length > 0).length;
            const words2 = text2.trim().split(/\s+/).filter(word => word.length > 0).length;
            
            document.getElementById('examWords1').textContent = words1;
            document.getElementById('examWords2').textContent = words2;
            
            const totalWords = words1 + words2;
            document.getElementById('totalWords').textContent = totalWords;
            
            // Calculate completion rate (target: 300-360 words total)
            const completionRate = Math.min(Math.round((totalWords / 330) * 100), 100);
            document.getElementById('completionRate').textContent = completionRate + '%';
        }
        
        function submitWriting() {
            const text = document.getElementById('writingArea').value;
            const wordCount = text.trim().split(/\s+/).filter(word => word.length > 0).length;
            
            if (wordCount < 150) {
                alert('⚠️ Il testo è troppo breve. Continua a scrivere per raggiungere almeno 150 parole.');
                return;
            }
            
            clearInterval(timerInterval);
            
            // Simulate AI evaluation
            const score = Math.floor(Math.random() * 20) + 75; // 75-95
            const feedback = generateDetailedFeedback(text, score);
            
            document.getElementById('writingExerciseContent').innerHTML = `
                <h3>🎉 Valutazione Completata!</h3>
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 15px; padding: 30px; margin: 20px 0; text-align: center;">
                    <div style="font-size: 3em; margin-bottom: 15px;">🏆</div>
                    <h4 style="margin: 0 0 15px 0;">Il Tuo Punteggio</h4>
                    <div style="font-size: 3em; font-weight: bold; margin: 15px 0;">${score}/100</div>
                    <div style="font-size: 1.2em; opacity: 0.9;">
                        ${score >= 90 ? 'Eccellente!' : score >= 80 ? 'Molto Bene!' : score >= 70 ? 'Buono!' : 'Da Migliorare'}
                    </div>
                </div>
                
                <div style="background: #f8f9fa; border-radius: 15px; padding: 25px; margin: 20px 0;">
                    <h4 style="margin-top: 0;">📋 Feedback Dettagliato</h4>
                    ${feedback}
                </div>
                
                <div style="text-align: center; margin-top: 25px;">
                    <button class="premium-btn" onclick="closeModal('writingExerciseModal')" style="margin-right: 15px;">✅ Continua</button>
                    <button class="premium-btn" onclick="openWritingExercise('adaptive')" style="background: #27ae60;">🔄 Nuovo Esercizio</button>
                </div>
            `;
        }
        
        function generateDetailedFeedback(text, score) {
            const wordCount = text.trim().split(/\s+/).filter(word => word.length > 0).length;
            let feedback = [];
            
            // Structure feedback
            if (text.includes('Egregio') || text.includes('Gentile')) {
                feedback.push('<div style="color: #27ae60;">✅ <strong>Struttura:</strong> Saluto formale appropriato</div>');
            } else {
                feedback.push('<div style="color: #f39c12;">⚠️ <strong>Struttura:</strong> Manca un saluto formale adeguato</div>');
            }
            
            // Length feedback
            if (wordCount >= 200 && wordCount <= 250) {
                feedback.push('<div style="color: #27ae60;">✅ <strong>Lunghezza:</strong> Perfetta per la traccia</div>');
            } else if (wordCount < 200) {
                feedback.push('<div style="color: #f39c12;">⚠️ <strong>Lunghezza:</strong> Troppo breve, sviluppa di più</div>');
            } else {
                feedback.push('<div style="color: #f39c12;">⚠️ <strong>Lunghezza:</strong> Troppo lungo, sii più conciso</div>');
            }
            
            // Grammar feedback
            const subjunctivePatterns = ['che io sia', 'che tu sia', 'che lei sia', 'penso che', 'credo che'];
            const hasSubjunctive = subjunctivePatterns.some(pattern => text.toLowerCase().includes(pattern));
            if (hasSubjunctive) {
                feedback.push('<div style="color: #27ae60;">✅ <strong>Grammatica:</strong> Buon uso del congiuntivo</div>');
            } else {
                feedback.push('<div style="color: #e74c3c;">❌ <strong>Grammatica:</strong> Manca l\'uso del congiuntivo</div>');
            }
            
            // Vocabulary feedback
            const commonWords = ['molto', 'bello', 'buono'];
            const overused = commonWords.filter(word => 
                (text.toLowerCase().match(new RegExp(word, 'g')) || []).length > 1
            );
            if (overused.length === 0) {
                feedback.push('<div style="color: #27ae60;">✅ <strong>Lessico:</strong> Buona varietà lessicale</div>');
            } else {
                feedback.push('<div style="color: #f39c12;">⚠️ <strong>Lessico:</strong> Evita ripetizioni, usa sinonimi</div>');
            }
            
            return feedback.join('<br>');
        }
        
        function submitExam() {
            const text1 = document.getElementById('examText1').value;
            const text2 = document.getElementById('examText2').value;
            
            if (text1.trim().length < 100 || text2.trim().length < 100) {
                if (!confirm('⚠️ Una o entrambe le prove sembrano incomplete. Vuoi consegnare comunque?')) {
                    return;
                }
            }
            
            clearInterval(examTimerInterval);
            
            // Calculate scores
            const score1 = Math.floor(Math.random() * 15) + 35; // 35-50
            const score2 = Math.floor(Math.random() * 15) + 35; // 35-50
            const totalScore = score1 + score2;
            
            document.getElementById('examSimulationContent').innerHTML = `
                <h3>🎭 Esame Completato!</h3>
                <div style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; border-radius: 15px; padding: 30px; margin: 20px 0; text-align: center;">
                    <div style="font-size: 3em; margin-bottom: 15px;">${totalScore >= 60 ? '🎉' : '😔'}</div>
                    <h4 style="margin: 0 0 15px 0;">Risultato Finale</h4>
                    <div style="font-size: 2.5em; font-weight: bold; margin: 15px 0;">${totalScore}/100</div>
                    <div style="font-size: 1.2em; opacity: 0.9;">
                        ${totalScore >= 60 ? 'SUPERATO! 🎊' : 'NON SUPERATO 😞'}
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                    <div style="background: #f8f9fa; border-radius: 15px; padding: 20px; text-align: center;">
                        <h5 style="margin-top: 0;">📝 Prova 1 - Narrativo</h5>
                        <div style="font-size: 2em; font-weight: bold; color: ${score1 >= 30 ? '#27ae60' : '#e74c3c'};">${score1}/50</div>
                        <div style="font-size: 0.9em; color: #7f8c8d;">
                            ${score1 >= 40 ? 'Eccellente' : score1 >= 30 ? 'Sufficiente' : 'Insufficiente'}
                        </div>
                    </div>
                    <div style="background: #f8f9fa; border-radius: 15px; padding: 20px; text-align: center;">
                        <h5 style="margin-top: 0;">📧 Prova 2 - Formale</h5>
                        <div style="font-size: 2em; font-weight: bold; color: ${score2 >= 30 ? '#27ae60' : '#e74c3c'};">${score2}/50</div>
                        <div style="font-size: 0.9em; color: #7f8c8d;">
                            ${score2 >= 40 ? 'Eccellente' : score2 >= 30 ? 'Sufficiente' : 'Insufficiente'}
                        </div>
                    </div>
                </div>
                
                <div style="background: white; border-radius: 15px; padding: 20px; margin: 20px 0;">
                    <h5 style="margin-top: 0;">📊 Analisi Dettagliata</h5>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div style="text-align: center;">
                            <div style="font-size: 1.2em; color: #667eea;">Struttura</div>
                            <div style="font-size: 0.9em; color: #7f8c8d;">${Math.floor(Math.random() * 3) + 7}/10</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 1.2em; color: #667eea;">Grammatica</div>
                            <div style="font-size: 0.9em; color: #7f8c8d;">${Math.floor(Math.random() * 3) + 6}/10</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 1.2em; color: #667eea;">Lessico</div>
                            <div style="font-size: 0.9em; color: #7f8c8d;">${Math.floor(Math.random() * 3) + 7}/10</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 1.2em; color: #667eea;">Coerenza</div>
                            <div style="font-size: 0.9em; color: #7f8c8d;">${Math.floor(Math.random() * 3) + 8}/10</div>
                        </div>
                    </div>
                </div>
                
                <div style="text-align: center; margin-top: 25px;">
                    <button class="premium-btn" onclick="closeModal('examSimulationModal')" style="margin-right: 15px;">✅ Continua</button>
                    <button class="premium-btn" onclick="openExamSimulation()" style="background: #27ae60;">🔄 Ripeti Esame</button>
                </div>
            `;
        }
        
        function pauseExam() {
            if (examTimerInterval) {
                clearInterval(examTimerInterval);
                alert('⏸️ Esame in pausa. Clicca OK per riprendere.');
                // In a real implementation, you would restart the timer here
            }
        }
        
        function saveAsDraft() {
            const text = document.getElementById('writingArea').value;
            if (text.trim().length > 0) {
                alert('💾 Bozza salvata! Potrai continuare a lavorarci in seguito.');
            } else {
                alert('⚠️ Non c\'è niente da salvare. Scrivi qualcosa prima di salvare.');
            }
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            updateStats();
            
            // Simulate progress updates
            setInterval(() => {
                userData.totalExercises += Math.random() > 0.7 ? 1 : 0;
                userData.studyStreak += Math.random() > 0.9 ? 1 : 0;
                updateStats();
            }, 30000);
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98753142e4abd6ae',t:'MTc1OTI1MDc0NC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
